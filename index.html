<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="Qubo Qin&#39;s Blog">
<meta property="og:url" content="http://blog.magicefire.com/index.html">
<meta property="og:site_name" content="Qubo Qin&#39;s Blog">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Qubo Qin&#39;s Blog">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://blog.magicefire.com/"/>





  <title>Qubo Qin's Blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Qubo Qin's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.magicefire.com/Setup-Webpack-from-Scratch/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Qubo Qin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Qubo Qin's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/Setup-Webpack-from-Scratch/" itemprop="url">Setup Webpack from Scratch</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-12-31T16:25:26-08:00">
                2018-12-31
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Nodejs/" itemprop="url" rel="index">
                    <span itemprop="name">Nodejs</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="What-is-the-differnce-between-dirname-and-in-Nodejs"><a href="#What-is-the-differnce-between-dirname-and-in-Nodejs" class="headerlink" title="What is the differnce between __dirname and ./ in Nodejs"></a>What is the differnce between __dirname and ./ in Nodejs</h2><p>Three different situations need to be considered. </p>
<ol>
<li>In Nodejs, <code>__dirname</code> and <code>__filename</code> are always the directories in which these scripts reside.</li>
<li>By contrast, <code>./</code> and <code>../</code> are the directories from which you run these scripts in Nodejs environment when you use libraries like <code>path</code> and <code>fs</code>.</li>
<li>The paths in <code>require</code> are alway relative to these files.<br>FOr more detail information, here is the <a href="https://stackoverflow.com/questions/8131344/what-is-the-difference-between-dirname-and-in-node-js" target="_blank" rel="noopener">reference link</a> on Stackoverflow.   </li>
</ol>
<p>I give a example below, our directory is like this:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">src/server</span><br><span class="line">src</span><br><span class="line">├── app.js</span><br><span class="line">├── assets</span><br><span class="line">│   ├── js</span><br><span class="line">│   │   └── hello.js</span><br><span class="line">│   ├── media</span><br><span class="line">│   │   ├── config.json</span><br><span class="line">│   │   ├── sometext.txt</span><br><span class="line">│   │   └── webpacklogo.png</span><br><span class="line">│   └── scss</span><br><span class="line">│       ├── _color.scss</span><br><span class="line">│       └── app.scss</span><br><span class="line">├── index.html</span><br><span class="line">└── server</span><br><span class="line">    ├── api</span><br><span class="line">    │   └── google</span><br><span class="line">    │       └── pathtest.js</span><br><span class="line">    └── index.js</span><br></pre></td></tr></table></figure></p>
<p>and the <code>pathtest.js</code> contains<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'__filename = %s \n__dirname = %s'</span>, __filename, path.resolve(__dirname))</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'. = %s'</span>, path.resolve(<span class="string">'.'</span>))</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">require</span>(<span class="string">'../../../assets/media/config.json'</span>))</span><br><span class="line">  <span class="built_in">console</span>.log(fs.readFileSync(path.resolve(__dirname, <span class="string">'../../../assets/media/sometext.txt'</span>), <span class="string">'utf8'</span>))</span><br><span class="line">  <span class="built_in">console</span>.log(fs.readFileSync(<span class="string">'./src/assets/media/sometext.txt'</span>, <span class="string">'utf8'</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>the <code>server/index.js</code> is<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pathtest = <span class="built_in">require</span>(<span class="string">'./api/google/pathtest'</span>)</span><br><span class="line"></span><br><span class="line">pathtest()</span><br></pre></td></tr></table></figure></p>
<p>When we run the script in the parent directory of <code>src</code>,<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">webpack-boilerplate git:(master) ✗ node src/server/index.js</span><br></pre></td></tr></table></figure></p>
<p>we get this result in the console.<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">__filename = /Users/qinqubo/Magicefire/Playground/webpack-boilerplate/src/server/api/google/pathtest.js</span><br><span class="line">__dirname = /Users/qinqubo/Magicefire/Playground/webpack-boilerplate/src/server/api/google</span><br><span class="line">. = /Users/qinqubo/Magicefire/Playground/webpack-boilerplate</span><br><span class="line">&#123; hello: 'world' &#125;</span><br><span class="line">some txt</span><br><span class="line">some txt</span><br></pre></td></tr></table></figure></p>
<p>If we run this script in other directory, the second <code>readFileSync</code> function call will throw out an error in the console like this,<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">&#123; hello: &apos;world&apos; &#125;</span><br><span class="line">some txt</span><br><span class="line">fs.js:646</span><br><span class="line">  return binding.open(pathModule._makeLong(path), stringToFlags(flags), mode);</span><br><span class="line">                 ^</span><br><span class="line"></span><br><span class="line">Error: ENOENT: no such file or directory, open &apos;./src/assets/media/sometext.txt&apos;</span><br><span class="line">    at Object.fs.openSync (fs.js:646:18)</span><br><span class="line">    at Object.fs.readFileSync (fs.js:551:33)</span><br><span class="line">    at module.exports (/Users/qinqubo/Magicefire/Playground/webpack-boilerplate/src/server/api/google/pathtest.js:10:18)</span><br><span class="line">    at Object.&lt;anonymous&gt; (/Users/qinqubo/Magicefire/Playground/webpack-boilerplate/src/server/index.js:3:1)</span><br><span class="line">    at Module._compile (module.js:652:30)</span><br><span class="line">    at Object.Module._extensions..js (module.js:663:10)</span><br><span class="line">    at Module.load (module.js:565:32)</span><br><span class="line">    at tryModuleLoad (module.js:505:12)</span><br><span class="line">    at Function.Module._load (module.js:497:3)</span><br><span class="line">    at Function.Module.runMain (module.js:693:10)</span><br></pre></td></tr></table></figure></p>
<p>You can examine the differences between the two <code>readFileSync</code> function calls. Because the second one use <code>../</code> as its path, and these <code>./</code> and <code>../</code> are depended on the directory where you run the script. So the second one got an error.</p>
<p>I pushed the example code on <a href="https://github.com/postNirjhor/webpack-boilerplate" target="_blank" rel="noopener">Github</a>, you can check out on the <code>pathtest</code> branch.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.magicefire.com/From-MVC-to-MVVM-C-Step-by-Step/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Qubo Qin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Qubo Qin's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/From-MVC-to-MVVM-C-Step-by-Step/" itemprop="url">From MVC to MVVM-C, Step by Step, Part I</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-08-23T12:30:22-07:00">
                2018-08-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Software-Architecture/" itemprop="url" rel="index">
                    <span itemprop="name">Software Architecture</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Table-of-Contents"><a href="#Table-of-Contents" class="headerlink" title="Table of Contents"></a>Table of Contents</h1><h2 id="Preface"><a href="#Preface" class="headerlink" title="Preface"></a>Preface</h2><p>  In this article, I will share my experience how to refactor the codebase from MVC to MVVM-C. I will start with a simple example application, and do the refactoring step by step slowly to show you every key points of architecture pattern in iOS development.</p>
<h2 id="Introduction-of-the-Demo-application"><a href="#Introduction-of-the-Demo-application" class="headerlink" title="Introduction of the Demo application"></a>Introduction of the Demo application</h2><p>  I will create an application which is cloned from some applications about cryptocurrency market on Appstore. The application doesn’t touch any buying or selling actions, it just show the marketing data from Open APIs, so you don’t worry about your wallet :)</p>
<p>  It is a very simple example, including only four main pages.</p>
<p>  The “Prices” show the current marketing prices, you can input the name of cryptocurrency which you interested in to filter the table list, and you can also sort the order by click the name, price and change label on the section header.</p>
<p>  <img src="/From-MVC-to-MVVM-C-Step-by-Step/Price_View_Controller.png" width="50%" margin-left="auto" margin-right="auto"></p>
<p>  Swipe the table items in the price list, you can save these items into your favorite list. In the “My Favorites”, you can swipe the item to remove it from your favorite list.</p>
  <div display="flex"><br>  <img src="/From-MVC-to-MVVM-C-Step-by-Step/Swipe_to_Add_Favorite.png" width="30%" padding="5px"><br><br>  <img src="/From-MVC-to-MVVM-C-Step-by-Step/My_Favorites_ViewController.png" width="30%" padding="5px"><br><br>  <img src="/From-MVC-to-MVVM-C-Step-by-Step/Swipe_to_Remove_from_Favorite_List.png" width="30%" padding="5px"><br>  </div>

<p>  Click the item in the Price list, the item will be expanded to show a kline diagram.</p>
<p>  <img src="/From-MVC-to-MVVM-C-Step-by-Step/Expand_ViewController.png" width="50%" margin-left="auto" margin-right="auto"></p>
<p>  At the right cover of the price page, there is a setting button which will pop a setting page to let you choice the data source of the kline. You have two options, one is from Huobi, the other is from Crypto Compare. You can also click the switch to save your favorites then they will be reloaded when you open the application next time.</p>
<p>  <img src="/From-MVC-to-MVVM-C-Step-by-Step/Settings_ViewController.png" width="50%" margin-left="auto" margin-right="auto"></p>
<p>  That’s all. Though it is an really simple example, it still cover lots of knowledges in iOS development. But this article only focuses on some topics listed below:</p>
<ol>
<li>the architecture patterns: <br><br>From MVC, MVVM, MVVM+RxSwift to MVVM+RxSwift+Coordinator, so many acronyms, which architecture is the best? I think that none of them is the “Best” one. There is <strong> “No Silver Bullet”</strong>. Each one can suit better a specific scenario. But we must follow some principles. In this article, I will share my experience and list the pros and the cons of each pattern, and talk about how to make choice when I design an application.</li>
<li>how to implement the user interface: <br><br>The first thing in writing an application is implementing the user interface. But sometime we need essential data to help us to design the UI. Where these data come from? Do we need to write the networking layer first and fetch data from the backend? Or just grab some data through branch of http requests and save these data as an asset file in JSON format? <br><br><br>But there is another good idea that we can use some data mock platforms to generate these data automatically.<ul>
<li><a href="https://mockaroo.com/" target="_blank" rel="noopener">Mockaroo</a> <br><br><img src="/From-MVC-to-MVVM-C-Step-by-Step/Mockaroo.png" width="50%" margin-left="auto" margin-right="auto"></li>
<li><a href="https://github.com/easy-mock/easy-mock" target="_blank" rel="noopener">Easy Mock(大搜车)</a> <br><br><img src="/From-MVC-to-MVVM-C-Step-by-Step/Easy_Mock.png" width="50%" margin-left="auto" margin-right="auto"> <br><br>This is also an open source solution, you can build your own data mock platform on your computer.</li>
</ul>
</li>
<li>how to build a networking layer <br><br>After we finish our UI design, we must create service modules to connect the real world to get the data and present these data onto our UI components. If you are lazy, you can import a third party solution, the popular one is <a href="https://github.com/Alamofire/Alamofire" target="_blank" rel="noopener">Alamofire</a>. It is very easy to use and very powerful. But in this article I will build my networking layer from scratch. You can reference this paper <a href="https://medium.com/flawless-app-stories/writing-network-layer-in-swift-protocol-oriented-approach-4fa40ef1f908" target="_blank" rel="noopener">Writing a Network Layer in Swift: Protocol-Oriented Approach</a>. <a href="https://medium.com/@malcolmcollin" target="_blank" rel="noopener">Malcolm Kumwenda</a> is a good guy to help you create you own networking layer step by step. <br> <br><br>Why do I need to write networking layer by myself? One principle is we must implement the core module by ourselves and if these module are not very difficult to implement. Be careful to depend on a third party source, particularly when lots of other modules depend on it. You will take high risk to rely on these third party solutions.  </li>
<li>how to test your modules. <br><br>The deliver quality is based on how we dedicate on testing. And all outputs of refactoring the architecture are let us more easy to test our code. ViewModel separated from ViewController is more helpful to test the business logic and the presentational logic.</li>
<li>immigrate from procedural programming to functional Reactive Programming <br><br>Immigrating from procedural programming to declarative programming is just like people who immigrate to a new country where the language is totally different.<br>the life is hard, but it is still going on. If you estimate that the business logic and the state of your application will become more complicated as time goes by.</li>
</ol>
<blockquote>
<p>The functional programming paradigm was explicitly created to support a pure functional approach to problem solving. Functional programming is a form of declarative programming. In contrast, most mainstream languages, including object-oriented programming (OOP) languages such as C#, C++, and Java, were designed to primarily support imperative (procedural) programming.</p>
</blockquote>
<h2 id="Design-Our-UI"><a href="#Design-Our-UI" class="headerlink" title="Design Our UI"></a>Design Our UI</h2><p>Understanding how and when a view updates requires a deeper understanding of the  UIKit framework. This article focuses on the architecture patterns, so we will not talk more about the UI staffs. But the topics I discuss below are very important to you to build an application as quickly as possible.</p>
<h4 id="Storyboard-or-Programmatic-is-a-problem"><a href="#Storyboard-or-Programmatic-is-a-problem" class="headerlink" title="Storyboard or Programmatic is a problem"></a>Storyboard or Programmatic is a problem</h4><p>  Here is the whole picture of our pages in the storyboard.</p>
<p>  <img src="/From-MVC-to-MVVM-C-Step-by-Step/The_Whole_Picture_of_the_UI.png" width="90%" margin-left="auto" margin-right="auto"></p>
<p>  There are still lots of debates about whether to use storyboard or write UI programmatically. You can find a lot of articles to summarize the pros and cons on both sides(<a href="https://blog.bobthedeveloper.io/why-i-dont-use-storyboard-fe14a1a99f58" target="_blank" rel="noopener">Why I Don’t Use Storyboard</a> and <a href="https://medium.com/@chan.henryk/storyboard-vs-programmatically-in-swift-9a65ff6aaeae" target="_blank" rel="noopener">Storyboard vs Programmatically in Swift</a>). These are guidelines when I need to make a choice at the crossroads.</p>
<table>
<thead>
<tr>
<th>Storyboard</th>
<th>Programmatic</th>
</tr>
</thead>
<tbody>
<tr>
<td>Ease to use</td>
<td>Reusability</td>
</tr>
<tr>
<td>Visualization</td>
<td>Merge Conflict</td>
</tr>
</tbody>
</table>
<p>  In a big project, the choice is depended on your team and the consensus made in your team. I prefer using storyboard to create static view objects and doing it programmatically when I create visual objects dynamically.</p>
<blockquote>
<p>When I teach, I don’t wanna make my audience fall asleep. So, why not make it a little more interesting since seeing is believing.🤔</p>
</blockquote>
<p>  Because this is a demo application, and the UI is very simple, so using storyboard is good choice.</p>
<h4 id="How-many-view-controllers-do-we-need"><a href="#How-many-view-controllers-do-we-need" class="headerlink" title="How many view controllers do we need?"></a>How many view controllers do we need?</h4><p>  UX/UI designer create the wireframes by using <strong>Sketch</strong>. Sometimes we just map the pages in the sketch file to view controllers, they are almost one-on-one mapping. But be careful! Before apply other architecture paradigm, we start from MVC, and view controllers in MVC mode are so heavy, so discuss the features with your UX/UI designers or product designers first if you don’t want to mess up. Sometimes we must separate some of features in one page and move them into other view controllers. These view controllers are embedded in the “host” view controller as child view controllers. In our demo application, when we click on the item in the tableview, the cell will be expanded and show the kline of selected cryptocurrency, the expanded view in the cell view need a child view controller to coordinate the kline data service and the view who show the kline. So I  dynamically create a view controller named “ExpandViewcontroller” as a child view controller embedded in “CoinListViewController”.</p>
<p>  Expand the cell view and add the “ExpandViewcontroller” as a child view controller,<br>  <figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">expandViewController = <span class="type">UIStoryboard</span>(name: <span class="string">"Main"</span>, bundle: <span class="literal">nil</span>).instantiateViewController(withIdentifier: <span class="string">"ExpandViewController"</span>) <span class="keyword">as</span>! <span class="type">ExpandViewController</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">self</span>.addChildViewController(expandViewController)</span><br><span class="line">cell.expandView.addSubview(expandViewController.view)</span><br><span class="line"></span><br><span class="line">expandViewController.view.translatesAutoresizingMaskIntoConstraints = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="type">NSLayoutConstraint</span>.activate([</span><br><span class="line">    expandViewController.view.leadingAnchor.constraint(equalTo: cell.expandView.leadingAnchor),</span><br><span class="line">    expandViewController.view.trailingAnchor.constraint(equalTo: cell.expandView.trailingAnchor),</span><br><span class="line">    expandViewController.view.topAnchor.constraint(equalTo: cell.expandView.topAnchor),</span><br><span class="line">    expandViewController.view.bottomAnchor.constraint(equalTo: cell.expandView.bottomAnchor)</span><br><span class="line">    ])</span><br><span class="line"></span><br><span class="line">expandViewController.didMove(toParentViewController: <span class="keyword">self</span>)</span><br></pre></td></tr></table></figure></p>
<p>  Fold the cell view when we click the cell again,<br>  <figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">expandViewController?.view.removeFromSuperview()</span><br><span class="line">expandViewController?.removeFromParentViewController()</span><br><span class="line">expandViewController = <span class="literal">nil</span></span><br></pre></td></tr></table></figure></p>
<h4 id="AutoLayout-and-constraint"><a href="#AutoLayout-and-constraint" class="headerlink" title="AutoLayout and constraint"></a>AutoLayout and constraint</h4><p>  Being familiar with UIKit is very important for developing your user interface. And you must be prepare to move beyond the basics, and dive into the UI framework. When you do start writing iOS apps, you’ll have a solid and rigorous<br>  understanding of what you are doing and where you are heading.</p>
<p>  There are three stages before views can be displayed on the screen. The first step is “updating constrains”, which is form subviews to their superviews(bottom-up). It will prepare the information needed for the second step called “layout”. In this step, frames(centers and bounds) of views will be set depending on the constrain system. Finally the “display” pass renders the views on the screen.</p>
<p>  Before you take control of layout, you need to know how to trigger the override functions in these three steps, and when to trigger these functions. The table below lists all relative functions in these steps.</p>
<table>
<thead>
<tr>
<th>Method purposes</th>
<th>Constraints</th>
<th>Layout</th>
<th>Display</th>
</tr>
</thead>
<tbody>
<tr>
<td>Implement updates (override, don’t call explicitly)</td>
<td>updateConstraints</td>
<td>layoutSubviews</td>
<td>draw</td>
</tr>
<tr>
<td>Explicitly mark view as needing update on next update cycle</td>
<td>setNeedsUpdateConstraints invalidateIntrinsicContentSize</td>
<td>setNeedsLayout</td>
<td>setNeedsDisplay</td>
</tr>
<tr>
<td>Update immediately if view is marked as “dirty”</td>
<td>updateConstraintsIfNeeded</td>
<td></td>
<td>layoutIfNeeded</td>
</tr>
<tr>
<td>Actions that implicitly cause views to be updated</td>
<td>Activate/deactivate constraints<br>Change constraint’s value or priority<br>Remove view from view hierarchy</td>
<td>addSubview<br>Resizing a view setFrame that changes a view’s bounds (not just a translation)<br>User scrolls a UIScrollView<br>User rotates device</td>
<td>Changes in a view’s bounds</td>
</tr>
</tbody>
</table>
<h5 id="A-good-example-of-changing-the-local-constraints"><a href="#A-good-example-of-changing-the-local-constraints" class="headerlink" title="A good example of changing the local constraints"></a>A good example of changing the local constraints</h5><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create a new property to hold the aspect ratio constraint of an imageView</span></span><br><span class="line"><span class="keyword">fileprivate</span> <span class="keyword">var</span> aspectRatioConstraint:<span class="type">NSLayoutConstraint</span>?</span><br><span class="line"></span><br><span class="line"><span class="comment">// Override the updateConstraints function to recreate the aspect ratio constraint depending on the image width and height</span></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">updateConstraints</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">super</span>.updateConstraints()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> aspectRatio: <span class="type">CGFloat</span> = <span class="number">1</span></span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">let</span> image = image &#123;</span><br><span class="line">    aspectRatio = image.size.width / image.size.height</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// setting the isActive of a constraint to false will make this constraint be nil, so you need to create a new one</span></span><br><span class="line">  aspectRatioConstraint?.isActive = <span class="literal">false</span></span><br><span class="line">  aspectRatioConstraint =</span><br><span class="line">      imageView.widthAnchor.constraint(</span><br><span class="line">        equalTo: imageView.heightAnchor,</span><br><span class="line">        multiplier: aspectRatio)</span><br><span class="line">  aspectRatioConstraint?.isActive = <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Change the image property declaration in order to invalidate the constraints and trigger the autolayout process again:</span></span><br><span class="line"><span class="keyword">var</span> image: <span class="type">UIImage</span>? &#123;</span><br><span class="line">  <span class="keyword">didSet</span> &#123;</span><br><span class="line">    imageView.image = image</span><br><span class="line">    setNeedsUpdateConstraints()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Change-constraints-with-animations"><a href="#Change-constraints-with-animations" class="headerlink" title="Change constraints with animations"></a>Change constraints with animations</h5><p>If you want to replace the default behaviors of constraints animation, you must call the <em>layoutIfNeeded</em> function in the animation block, otherwise the change of the constraint will be executed in the update cycle of the run loop, so the animation block you defined will be useless.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">collapseHeader</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="type">UIView</span>.animate(withDuration: <span class="number">1.2</span>, animations: &#123;</span><br><span class="line">        <span class="keyword">self</span>.headerHeightConstraint.constant = <span class="keyword">self</span>.minHeaderHeight</span><br><span class="line">        <span class="keyword">self</span>.view.layoutIfNeeded()</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">expandHeader</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="type">UIView</span>.animate(withDuration: <span class="number">0.2</span>, animations: &#123;</span><br><span class="line">        <span class="keyword">self</span>.headerHeightConstraint.constant = <span class="keyword">self</span>.maxHeaderHeight</span><br><span class="line">        <span class="keyword">self</span>.view.layoutIfNeeded()</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>In the <em>updateConstraints()</em> function, you can’t invalidate any constraints, otherwise you will get a crash because your program has already been in the layout cycle.<br><img src="/From-MVC-to-MVVM-C-Step-by-Step/Update_Cycle.png" width="80%" margin-left="auto" margin-right="auto"><br><br>You can change the properties which are relative with the constraints, then invalidate constraints and trigger the layout process in the event process stage of the main run loop, then the system will call the callback function <em>updateConstraints</em> you override in the <strong> <em>update cycle</em> </strong> . In this function, you can change/remove/add constraints which depending on the properties changing before. This guideline can also apply to the process of layout and display.</p>
<p>There are some scenarios about how to fine-tune the frames of your views by overriding the <em>layoutSubviews</em> function. The first one is not necessary, because you can add a constraint, but it is an example.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">- layoutSubviews</span><br><span class="line">&#123;</span><br><span class="line">    [super layoutSubviews];</span><br><span class="line">    if (self.subviews[0].frame.size.width &lt;= MINIMUM_WIDTH) &#123;</span><br><span class="line">        [self removeSubviewConstraints];</span><br><span class="line">        self.layoutRows += 1;</span><br><span class="line">        [super layoutSubviews];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- updateConstraints</span><br><span class="line">&#123;</span><br><span class="line">    // add constraints depended on self.layoutRows...</span><br><span class="line">    [super updateConstraints];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>There is a trick. Because the layout process is top-down, you can get the frame of the current view before you call the super function <em>layoutSubviews</em>. After the super function <em>layoutSubviews</em> being called, the subviews of this view also get their frames, so you can get the sizes and positions of its’ subviews. In this case, we compare the width of the first subview, and change the <em>layoutRows</em> property, then call its’ super <em>layoutSubviews</em> to fire the autolayout process from the updating constraints step again.<br><br>You can also subclass your first subview(in this case), and override the <em>layoutSubviews</em> function in its’ subclass, and get its’ frame like the next example which fine-tune the width of a multi-line label</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@implementation MyLabel</span><br><span class="line">- (void)layoutSubviews</span><br><span class="line">&#123;</span><br><span class="line">    self.preferredMaxLayoutWidth = self.frame.size.width;</span><br><span class="line">    [super layoutSubviews];</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Or you can make this adjustment at the view controller level, put this logic into the <em>viewDidLayoutSubviews</em> function. Because the autolayout process is finished,  so you must re-fire this process by calling <em>layoutIfNeeded</em></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- (void)viewDidLayoutSubviews</span><br><span class="line">&#123;</span><br><span class="line">    [super viewDidLayoutSubviews];</span><br><span class="line">    myLabel.preferredMaxLayoutWidth = myLabel.frame.size.width;</span><br><span class="line">    [self.view layoutIfNeeded];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="StackView-with-Fill-Distribution"><a href="#StackView-with-Fill-Distribution" class="headerlink" title="StackView with Fill Distribution"></a>StackView with Fill Distribution</h5><h4 id="Core-Animation’s-models-classes-and-blocks"><a href="#Core-Animation’s-models-classes-and-blocks" class="headerlink" title="Core Animation’s models, classes and blocks"></a>Core Animation’s models, classes and blocks</h4><p>  Animation in iOS is huge topic, but the animation process can be as simple as changing properties during a given time. It includes two main animation systems. One is based on “View Animation”, and the other is called “Core Animation”. I only list some key issues about Animation.</p>
<h5 id="View-Animation"><a href="#View-Animation" class="headerlink" title="View Animation"></a>View Animation</h5><p>  There are three stages for “View Animation” because of the historical evolution of iOS. I just give some snippet codes below for each of these stages.</p>
<ul>
<li><p>Begin and commit</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">UIView</span>.beginAnimations(<span class="literal">nil</span>, context: <span class="literal">nil</span>)</span><br><span class="line"><span class="type">UIView</span>.setAnimationDuration(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">self</span>.v.backgroundColor = .red</span><br><span class="line"><span class="type">UIView</span>.commitAnimations()</span><br></pre></td></tr></table></figure>
</li>
<li><p>Block-based animation</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">UIView</span>.animate(withDuration:<span class="number">1</span>) &#123;</span><br><span class="line">  <span class="keyword">self</span>.v.backgroundColor = .red</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Property animator</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> anim = <span class="type">UIViewPropertyAnimator</span>(duration: <span class="number">1</span>, curve: .linear) &#123;</span><br><span class="line">    <span class="keyword">self</span>.v.backgroundColor = .red</span><br><span class="line">&#125;</span><br><span class="line">anim.startAnimation()</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="Implicit-Layer-Animation"><a href="#Implicit-Layer-Animation" class="headerlink" title="Implicit Layer Animation"></a>Implicit Layer Animation</h5><p>  Before we jump to “Core Animation”, we also can change properties on CALayer. It is called “Implicit Layer Animation”. Just set layer properties, and your layers animate in the default way. You can not control the animation except you use a “CATransaction” with “Implicit Layer Animation”. And remember, there is always an implicit transaction surrounding your code, and you can operate on this implicit transaction without any begin and commit.</p>
  <figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// can be omitted</span></span><br><span class="line"><span class="type">CATransaction</span>.begin()</span><br><span class="line"></span><br><span class="line"><span class="type">CATransaction</span>.setAnimationDuration(<span class="number">0.8</span>)</span><br><span class="line"><span class="keyword">self</span>.globalLabel.layer.transform = <span class="type">CATransform3DMakeRotation</span>(<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// can be omitted</span></span><br><span class="line"><span class="type">CATransaction</span>.commit()</span><br></pre></td></tr></table></figure>
<h5 id="Core-Animation"><a href="#Core-Animation" class="headerlink" title="Core Animation"></a>Core Animation</h5><p>  “Core Animation” is also called “Explicit Layer Animation”. To specify a property using a keyPath, we can create an CABasicAnimation object or its inheritance, then we add this object onto the layer of a view. There are two problems when we use “Core Animation”. One is setting a property on a layer will fire the “Implicit Layer Animation”, We can prevent this side effect by disabling actions:</p>
  <figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">CATransaction</span>.begin()</span><br><span class="line"><span class="type">CATransaction</span>.setDisableActions(<span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> transformAnimation = <span class="type">CABasicAnimation</span>(keyPath: #keyPath(<span class="type">CALayer</span>.transform))</span><br><span class="line">transformAnimation.fromValue = <span class="type">CATransform3DMakeRotation</span>(<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">transformAnimation.toValue = <span class="type">CATransform3DMakeRotation</span>(<span class="type">CGFloat</span>(<span class="type">Double</span>.pi), <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">transformAnimation.duration = <span class="number">2</span></span><br><span class="line">transformAnimation.autoreverses = <span class="literal">true</span></span><br><span class="line">transformAnimation.repeatCount = .infinity</span><br><span class="line"></span><br><span class="line"><span class="type">CATransaction</span>.setCompletionBlock(&#123;</span><br><span class="line">  <span class="keyword">self</span>.globalLabel.layer.transform = <span class="type">CATransform3DMakeRotation</span>(<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">self</span>.globalLabel.layer.add(transformAnimation, forKey: #keyPath(<span class="type">CALayer</span>.transform))</span><br><span class="line"></span><br><span class="line"><span class="type">CATransaction</span>.commit()</span><br></pre></td></tr></table></figure>
<p>  The other problem is if we use “Core Animation”, the property will not change to the value when the animation is end, because “Core Animation” create a new layer to present the animation, called “presentation layer”. So we need it set the new value into the property of its “model layer” in the completion block.</p>
<p>  If you use “Implicit Layer Animation” or “View Animation”, you don’t need to care about these problems, because the Animation framework will handle these for you. But when you use the “Core Animation” which is the fundamental underlying iOS animation technology, you get more powerful, so you need more responsibility.</p>
<h5 id="Transitions"><a href="#Transitions" class="headerlink" title="Transitions"></a>Transitions</h5><p>  Another concept called “Transitions” is very confused, if you are not a native English speaker. Usually we use “Transitions” in two situations. We can change the content of a view such as the image of a UIImageView using “transition(with:duration:options:animations:completion:)” function:<br>  <figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> opts : <span class="type">UIViewAnimationOptions</span> = .transitionFlipFromLeft</span><br><span class="line"><span class="type">UIView</span>.transition(with:<span class="keyword">self</span>.iv, duration: <span class="number">0.8</span>, options: opts, animations: &#123;</span><br><span class="line">    <span class="keyword">self</span>.iv.image = <span class="type">UIImage</span>(named:<span class="string">"Smiley"</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>  Or we can replace the first view with the second view by using “transition(from:to:duration:options:completion:)” function.<br>  <figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">let</span> lab2 = <span class="type">UILabel</span>(frame:<span class="keyword">self</span>.lab.frame)</span><br><span class="line">    lab2.text = <span class="keyword">self</span>.lab.text == <span class="string">"Hello"</span> ? <span class="string">"Howdy"</span> : <span class="string">"Hello"</span></span><br><span class="line">    lab2.sizeToFit()</span><br><span class="line">    <span class="type">UIView</span>.transition(from:<span class="keyword">self</span>.lab, to: lab2,</span><br><span class="line">        duration: <span class="number">0.8</span>, options: .transitionFlipFromLeft) &#123; <span class="number">_</span> <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">self</span>.lab = lab2</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="Custom-UIViewController-Transitions"><a href="#Custom-UIViewController-Transitions" class="headerlink" title="Custom UIViewController Transitions"></a>Custom UIViewController Transitions</h4><p>The transitioning API includes several components which conform a collection of protocols. The diagram below shows these relative components:</p>
<p><img src="/From-MVC-to-MVVM-C-Step-by-Step/Transitioning_API.jpg" width="80%" margin-left="auto" margin-right="auto"><br></p>
<p>Here is the 7 steps involved in a presentation transition:</p>
<ol>
<li><p>Before You trigger the transition either programmatically or via a segue, you need to set the transitioningDelegate property in your “to” view controller. In this case, the transitioningDelegate is the “from” view controller. The “from” view controller in here is also the <strong> presenting </strong> view controller. When you trigger the transition via a segue, the override function <em>prepare(for:</em>)_ in the presenting view controller will be called, in this function, you can get the “to” view controller(also called “<strong> presented </strong>“) form the segue destination. Then you can set the transitioningDelegate property of the destination to itself.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">prepare</span><span class="params">(<span class="keyword">for</span> segue: UIStoryboardSegue, sender: Any?)</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.prepare(<span class="keyword">for</span>: segue, sender: sender)</span><br><span class="line">    segue.destination.transitioningDelegate = <span class="keyword">self</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> navigationController = segue.destination <span class="keyword">as</span>? <span class="type">SettingsNavigationController</span>,</span><br><span class="line">    <span class="keyword">let</span> settingsViewController = navigationController.viewControllers.first <span class="keyword">as</span>? <span class="type">SettingsViewController</span> &#123;</span><br><span class="line">      settingsViewController.delegate = <span class="keyword">self</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>UIKit asks the “presented” view controller (the view controller to be shown) for its transitioning delegate. If it doesn’t have one, UIKIt uses the standard, built-in transition. In here the delegate is the presenting view controller. The transition delegate conforms two methods of <strong> UIViewControllerTransitioningDelegate protocol </strong>. One is for presenting, the other is for dismissing.</p>
</li>
<li>UIKit then asks the transitioning delegate for an animation controller via animationController(forPresented:presenting:source:). If this returns nil, the transition will use the default animation. The transition delegate create and return an animation controller who confirms the <strong> UIViewControllerAnimatedTransitioning protocol </strong></li>
<li>UIKit constructs the transitioning context. Be careful, if you want to see the presenting view controller behind the presented view controller, you need to set the presentation style to .overFullScreen or .overCurrentContext. If you set this property to .fullScreen, the view of the presenting view controller will be replaced</li>
<li>UIKit asks the animation controller for the duration of its animation by calling transitionDuration(using:).</li>
<li>UIKit invokes animateTransition(using:) on the the animation controller to perform the animation for the transition.</li>
<li>Finally, the animation controller calls completeTransition(_:) on the transitioning context to indicate that the animation is complete.</li>
</ol>
<p>And the steps for a dismissing transition are nearly identical.<br>When you tigger the reserves process, UIKit asks the transitioning delegate for an animation controller animationController(forDismissed dismissed:), then repeat the steps from 4 to 7.</p>
<p>Here is the animation controller code who play the animation role:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PresentTransitionController</span>: <span class="title">NSObject</span>, <span class="title">UIViewControllerAnimatedTransitioning</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">transitionDuration</span><span class="params">(using transitionContext: UIViewControllerContextTransitioning?)</span></span> -&gt; <span class="type">TimeInterval</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0.6</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">animateTransition</span><span class="params">(using transitionContext: UIViewControllerContextTransitioning)</span></span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> fromViewController = transitionContext.viewController(forKey: .from)!</span><br><span class="line">        <span class="keyword">let</span> toViewController = transitionContext.viewController(forKey: .to)!</span><br><span class="line">        <span class="keyword">let</span> containerView = transitionContext.containerView</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> screenBounds = <span class="type">UIScreen</span>.main.bounds</span><br><span class="line">        <span class="keyword">let</span> topOffset: <span class="type">CGFloat</span> = <span class="number">160.0</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> finalFrame = transitionContext.finalFrame(<span class="keyword">for</span>: toViewController)</span><br><span class="line">        finalFrame.origin.y += topOffset</span><br><span class="line">        finalFrame.size.height -= topOffset</span><br><span class="line"></span><br><span class="line">        toViewController.view.frame = <span class="type">CGRect</span>(x: <span class="number">0.0</span>, y: screenBounds.size.height,</span><br><span class="line">                                             width: finalFrame.size.width,</span><br><span class="line">                                             height: finalFrame.size.height)</span><br><span class="line">        containerView.addSubview(toViewController.view)</span><br><span class="line"></span><br><span class="line">        <span class="type">UIView</span>.animate(withDuration: transitionDuration(using: transitionContext), delay: <span class="number">0.0</span>, usingSpringWithDamping: <span class="number">0.8</span>, initialSpringVelocity: <span class="number">1.0</span>, options: .curveEaseOut, animations: &#123;</span><br><span class="line">            toViewController.view.frame = finalFrame</span><br><span class="line">            fromViewController.view.alpha = <span class="number">0.3</span></span><br><span class="line">        &#125;) &#123; (finished) <span class="keyword">in</span></span><br><span class="line">            transitionContext.completeTransition(finished)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Add-Gesture-On-the-Section-header"><a href="#Add-Gesture-On-the-Section-header" class="headerlink" title="Add Gesture On the Section header"></a>Add Gesture On the Section header</h4><h2 id="Connect-with-internet"><a href="#Connect-with-internet" class="headerlink" title="Connect with internet"></a>Connect with internet</h2><p>We already have got the “Views” in MVC pattern, it is time to build the “Models” and create networking service to connect with our backend. There are lots of approaches to build the “Models” and networking service.</p>
<ol>
<li><p>The most formal way is introducing some mocks and stubs before creating real data models and connecting the endpoints. The frontend developing will not depend on the progress of the backend developing. As I mentioned before you can use the data mock platform to mock the data we need, some of these platform are open source. You can setup your own data mock platform on your laptop, and you also can use their online service to create data, then download and save to a JSON file as a resource embedded into your application bundle. The other benefit is you can use these mock data to test your business logics and application logics. You will not stuck in debugging with backend engineers and complain each other, and the testers who get theirs test sets can help you test your application and business logics.</p>
</li>
<li><p>If the backend service is ready and stable. You can skip the step to build the mock data and stubs. Importing a third party module is also a good choice. <a href="https://github.com/Alamofire/Alamofire" target="_blank" rel="noopener">Alamofire</a> is one of the famous open sources. Using a heavy library sometimes you must be careful, if you don’t want to relay on this one.</p>
</li>
<li><p>There are an assumption that building a networking framework is a big challenge. Implementing the basic feature I think is not difficult, you can reference this topic <a href="https://medium.com/flawless-app-stories/writing-network-layer-in-swift-protocol-oriented-approach-4fa40ef1f908" target="_blank" rel="noopener">“Writing a Network Layer in Swift: Protocol-Oriented Approach<br>“</a> from Malcolm Kumwenda. This guy write a good article to teach you how to build your own networking layer step by step.</p>
</li>
</ol>
<p>First I wrote a http request using the native API <strong><em>URLSession</em></strong>, extend each model with a JSON initializer, handle the nested objects. When I get the data from a http request, I map the JSON format into a corresponding object.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Ticket</span> </span>&#123;</span><br><span class="line">    <span class="keyword">init</span>?(from json: [<span class="type">String</span>: <span class="type">Any</span>]) &#123;</span><br><span class="line">        <span class="keyword">guard</span></span><br><span class="line">            <span class="keyword">let</span> id = json[<span class="string">"id"</span>] <span class="keyword">as</span>? <span class="type">UInt</span>,</span><br><span class="line">            <span class="keyword">let</span> name = json[<span class="string">"name"</span>] <span class="keyword">as</span>? <span class="type">String</span>,</span><br><span class="line">            <span class="keyword">let</span> symbol = json[<span class="string">"symbol"</span>] <span class="keyword">as</span>? <span class="type">String</span>,</span><br><span class="line">            <span class="keyword">let</span> website_slug = json[<span class="string">"website_slug"</span>] <span class="keyword">as</span>? <span class="type">String</span>,</span><br><span class="line">            <span class="keyword">let</span> rank = json[<span class="string">"rank"</span>] <span class="keyword">as</span>? <span class="type">UInt</span>,</span><br><span class="line">            <span class="keyword">let</span> circulating_supply = json[<span class="string">"circulating_supply"</span>] <span class="keyword">as</span>? <span class="type">Double</span>,</span><br><span class="line">            <span class="keyword">let</span> total_supply = json[<span class="string">"total_supply"</span>] <span class="keyword">as</span>? <span class="type">Double</span>,</span><br><span class="line">            <span class="keyword">let</span> max_supply = json[<span class="string">"max_supply"</span>] <span class="keyword">as</span>? <span class="type">Double</span>,</span><br><span class="line">            <span class="keyword">let</span> quotesDict = json[<span class="string">"quotes"</span>] <span class="keyword">as</span>? [<span class="type">String</span>: <span class="type">Any</span>],</span><br><span class="line">            <span class="keyword">let</span> last_updated = json[<span class="string">"last_updated"</span>] <span class="keyword">as</span>? <span class="type">UInt64</span></span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">self</span>.<span class="keyword">init</span>(id: id,</span><br><span class="line">                  name: name,</span><br><span class="line">                  symbol: symbol,</span><br><span class="line">                  website_slug: website_slug,</span><br><span class="line">                  rank: rank,</span><br><span class="line">                  circulating_supply: circulating_supply,</span><br><span class="line">                  total_supply: total_supply,</span><br><span class="line">                  max_supply: max_supply,</span><br><span class="line">                  quotes: <span class="type">Dictionary</span>(uniqueKeysWithValues:</span><br><span class="line">                    quotesDict.<span class="built_in">map</span> &#123; key, value <span class="keyword">in</span></span><br><span class="line">                        <span class="keyword">let</span> (key, value) = (key, <span class="type">QUOTE</span>(from: (value <span class="keyword">as</span>? [<span class="type">String</span>: <span class="type">Any</span>])!))</span><br><span class="line">                        <span class="keyword">return</span> (key, value!)</span><br><span class="line">                    &#125;</span><br><span class="line">                  ),</span><br><span class="line">                  last_updated: last_updated)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> url = <span class="type">URL</span>(string: <span class="string">"https://api.coinmarketcap.com/v2/ticker/"</span>)!</span><br><span class="line"></span><br><span class="line">session.dataTask(with: url) &#123; (data, response, error) <span class="keyword">in</span></span><br><span class="line">    <span class="type">DispatchQueue</span>.main.async &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> error = error &#123;</span><br><span class="line">            completionHandler(.error(error))</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">guard</span></span><br><span class="line">            <span class="keyword">let</span> data = data,</span><br><span class="line">            <span class="keyword">let</span> jsonObject = <span class="keyword">try</span>? <span class="type">JSONSerialization</span>.jsonObject(with: data, options: []),</span><br><span class="line">            <span class="keyword">let</span> jsonDict = jsonObject <span class="keyword">as</span>? [<span class="type">String</span>: <span class="type">Any</span>],</span><br><span class="line">            <span class="keyword">let</span> dataDict = jsonDict[<span class="string">"data"</span>] <span class="keyword">as</span>? [<span class="type">String</span>: <span class="type">Any</span>]</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            completionHandler(.error(<span class="type">ServiceError</span>.cannotParse))</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> items = dataDict.values.<span class="built_in">map</span>&#123; $<span class="number">0</span> &#125; <span class="keyword">as</span>? [[<span class="type">String</span>: <span class="type">Any</span>]]</span><br><span class="line">        <span class="keyword">let</span> tickets = items!.compactMap(<span class="type">Ticket</span>.<span class="keyword">init</span>)</span><br><span class="line">        completionHandler(.success(tickets))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;.resume()</span><br></pre></td></tr></table></figure>
<p>It is not a bad idea, if you write a simple example, but it will turn to a disaster quickly when you write a real application. But I don’t want to use the Alamofire right now. So I followed Malcolm Kumwenda to create my own networking library, base on his codebase, I make a little change to support multi data sources.</p>
<p>The diagram is showed below, there three main roles in this diagram<br><img src="/From-MVC-to-MVVM-C-Step-by-Step/Networking.png" width="80%" margin-left="auto" margin-right="auto"><br></p>
<ol>
<li><p>Different endpoints in every data source are defined in different enums(<strong><em>Huobi API, CoinMarketAPI and CryptoCompareAPI</em></strong>), these enums all conform EndPointType protocol, you can get http parameters, paths and methods from these variables in this protocol, the return values depend on the values of the enums.</p>
</li>
<li><p>Router is a generic class. Giving different EndPoints, we can create different routers. The responsibility of this Router is prepare the parameters depending on the given endpoints, then trigger the real url sessions.</p>
</li>
<li><p>Our application involve three websites: Huobi, CoinMarket and CryptoCompare. So we create three NetworkManagers for each site. These NetworkManagers are all singleton, creating a router using an endpoint to replace the placeholder is their only jobs, then inject this router into themselves. These NetworkManagers all inherit form NetworkManager who handle the errors during the networking requests, and parse the JSON result form backend. It aslo managers all tasks created by the router. You can cancel these tasks by unique id.</p>
</li>
<li><p>NetworkEnvironment is a singleton class which distinguishs different running environment:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">NetworkEnvironment</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> qa</span><br><span class="line">    <span class="keyword">case</span> product</span><br><span class="line">    <span class="keyword">case</span> staging</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>In Swift 4 they provide Decodable protocol, I use this to convert my JSON objects to an equivalent Struct or Class. Sometimes you don’t need to write a single line, but if the names of the properties in our Classes are different from the keys returning from backend, we need to build the mapping.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//MARK: Listings</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Item</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> id: <span class="type">UInt</span></span><br><span class="line">    <span class="keyword">let</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">let</span> symbol: <span class="type">String</span></span><br><span class="line">    <span class="keyword">let</span> websiteSlug: <span class="type">String</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Item</span>: <span class="title">Decodable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">enum</span> <span class="title">ItemCodingKeys</span>: <span class="title">String</span>, <span class="title">CodingKey</span> </span>&#123;</span><br><span class="line">        <span class="keyword">case</span> id</span><br><span class="line">        <span class="keyword">case</span> name</span><br><span class="line">        <span class="keyword">case</span> symbol</span><br><span class="line">        <span class="keyword">case</span> websiteSlug = <span class="string">"website_slug"</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(from decoder: <span class="type">Decoder</span>) <span class="keyword">throws</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> itemContainer = <span class="keyword">try</span> decoder.container(keyedBy: <span class="type">ItemCodingKeys</span>.<span class="keyword">self</span>)</span><br><span class="line"></span><br><span class="line">        id = <span class="keyword">try</span> itemContainer.decode(<span class="type">UInt</span>.<span class="keyword">self</span>, forKey: .id)</span><br><span class="line">        name = <span class="keyword">try</span> itemContainer.decode(<span class="type">String</span>.<span class="keyword">self</span>, forKey: .name)</span><br><span class="line">        symbol = <span class="keyword">try</span> itemContainer.decode(<span class="type">String</span>.<span class="keyword">self</span>, forKey: .symbol)</span><br><span class="line">        websiteSlug = <span class="keyword">try</span> itemContainer.decode(<span class="type">String</span>.<span class="keyword">self</span>, forKey: .websiteSlug)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="The-Bridge-Controllers"><a href="#The-Bridge-Controllers" class="headerlink" title="The Bridge - Controllers"></a>The Bridge - Controllers</h2><p>Now we have the two important elements “Views” and “Models” in MVC pattern. We will finish our business logics and application logics in our “Controllers” to connect our “Views” with our “Models”.</p>
<p>The main feature of this demo application is fetch data from three websites who provide real time exchange infos of cryptocurrencies, and show these data in a tableview. Thee is no business logic at the front end, and this application only contains some simple application logics:</p>
<ol>
<li>Filter the result got from the network by typing some keywords at the top of the tableview.</li>
<li>Choice whether or not to list tokens by clicking a switch of selecting cryptocurrency type.</li>
<li>Sort the list in a descending or ascending order by name or price or change rate.</li>
<li>You can swipe the tableview item in the price view controller to add this cryptocurrency into your favorite list. You can also remove it from your favorite list. This favorite list will be saved, and will be reload when this application is being launched.</li>
<li>When you click the item, the tableview cell will be expanded, and show the kline of the selected cryptocurrency in a chart.</li>
<li>As a demo application, I add a feature that you can select different data sources of this kline in the setting view controller.</li>
<li>It will pop a webview to present the detail information of the selected cryptocurrency, when you tap the “eye” on the right top of the expanded chart view.</li>
</ol>
<p>Writing these application logics is not a big challenge. After I added a few lines of code, I can filter this list by some keywords and type. But when I was adding the sorting logic, I was aware that I had already messed around the view controllers.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> ticker = showCoinOnly ? (whichHeader == .coin ? sortTickers(_tickers.<span class="built_in">filter</span>(&#123; !$<span class="number">0</span>.isToken &#125;))[indexPath.row] : _tickers.<span class="built_in">filter</span>(&#123; !$<span class="number">0</span>.isToken &#125;)[indexPath.row])</span><br><span class="line">    : (indexPath.section == <span class="number">0</span> ? (whichHeader == .coin ? sortTickers(_tickers.<span class="built_in">filter</span>(&#123; !$<span class="number">0</span>.isToken &#125;))[indexPath.row] : _tickers.<span class="built_in">filter</span>(&#123; !$<span class="number">0</span>.isToken &#125;)[indexPath.row])</span><br><span class="line">        : (whichHeader == .token ? sortTickers(_tickers.<span class="built_in">filter</span>(&#123; $<span class="number">0</span>.isToken &#125;))[indexPath.row] : _tickers.<span class="built_in">filter</span>(&#123; $<span class="number">0</span>.isToken &#125;)[indexPath.row]))</span><br></pre></td></tr></table></figure>
<p>But when I wanted to display the result on the tableview, Only three conditions I needed to apply on the result, this expression made me crazy, and I put this snippet in every place in the tableview controller. I realized that this code must be used and can be readable. All of the functions in the above code is filtering and sorting when some conditions is changed.</p>
<p><img src="/From-MVC-to-MVVM-C-Step-by-Step/Data_Filter.png" width="80%" margin-left="auto" margin-right="auto"><br></p>
<p>This diagram is more like some figures in reactive programming article, this is the main motivation why we need to change from functional programming paradigm to imperative mode. Let me finish the MVC part, because we still meet other problems. So I create an extension of Array where its element must be “Ticker”. Then I moved this logic into the “milter” function in this extension.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Array</span> <span class="title">where</span> <span class="title">Element</span> == <span class="title">Ticker</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">filter</span><span class="params">(BySearch searchText: String?)</span></span> -&gt; [<span class="type">Ticker</span>] &#123;</span><br><span class="line">        <span class="keyword">var</span> filterTickers = [<span class="type">Ticker</span>]()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> lowcasedSearchText = searchText?.lowercased() &#123;</span><br><span class="line">            filterTickers = <span class="keyword">self</span>.<span class="built_in">filter</span> &#123; $<span class="number">0</span>.fullName.lowercased().range(of: lowcasedSearchText) != <span class="literal">nil</span> &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> filterTickers.<span class="built_in">count</span> == <span class="number">0</span> &#123;</span><br><span class="line">            filterTickers = <span class="keyword">self</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> filterTickers</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">milter</span><span class="params">(filterBy searchText: String?, separatedBy section: Section, sortedBy condition: Sorting)</span></span> -&gt; [<span class="type">Ticker</span>] &#123;</span><br><span class="line">        <span class="keyword">var</span> filterTickers = [<span class="type">Ticker</span>]()</span><br><span class="line">        filterTickers = <span class="built_in">filter</span>(<span class="type">BySearch</span>: searchText)</span><br><span class="line"></span><br><span class="line">        filterTickers = filterTickers.<span class="built_in">filter</span> &#123;</span><br><span class="line">            <span class="keyword">switch</span> section &#123;</span><br><span class="line">            <span class="keyword">case</span> .coin:</span><br><span class="line">                <span class="keyword">return</span> !$<span class="number">0</span>.isToken</span><br><span class="line">            <span class="keyword">case</span> .token:</span><br><span class="line">                <span class="keyword">return</span> $<span class="number">0</span>.isToken</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> condition == .<span class="keyword">none</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> filterTickers</span><br><span class="line">        &#125;</span><br><span class="line">        filterTickers = filterTickers.sorted &#123;</span><br><span class="line">            <span class="keyword">switch</span> condition &#123;</span><br><span class="line">            <span class="keyword">case</span> .name:</span><br><span class="line">                <span class="keyword">return</span> $<span class="number">0</span>.fullName &lt; $<span class="number">1</span>.fullName</span><br><span class="line">            <span class="keyword">case</span> .nameDesc:</span><br><span class="line">                <span class="keyword">return</span> $<span class="number">0</span>.fullName &gt; $<span class="number">1</span>.fullName</span><br><span class="line">            <span class="keyword">case</span> .change:</span><br><span class="line">                <span class="keyword">return</span> $<span class="number">0</span>.quotes[<span class="string">"USD"</span>]!.percentChange24h &lt; $<span class="number">1</span>.quotes[<span class="string">"USD"</span>]!.percentChange24h</span><br><span class="line">            <span class="keyword">case</span> .changeDesc:</span><br><span class="line">                <span class="keyword">return</span> $<span class="number">0</span>.quotes[<span class="string">"USD"</span>]!.percentChange24h &gt; $<span class="number">1</span>.quotes[<span class="string">"USD"</span>]!.percentChange24h</span><br><span class="line">            <span class="keyword">case</span> .price:</span><br><span class="line">                <span class="keyword">return</span> $<span class="number">0</span>.quotes[<span class="string">"USD"</span>]!.price &lt; $<span class="number">1</span>.quotes[<span class="string">"USD"</span>]!.price</span><br><span class="line">            <span class="keyword">case</span> .priceDesc:</span><br><span class="line">                <span class="keyword">return</span> $<span class="number">0</span>.quotes[<span class="string">"USD"</span>]!.price &gt; $<span class="number">1</span>.quotes[<span class="string">"USD"</span>]!.price</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">return</span> $<span class="number">0</span>.fullName &lt; $<span class="number">1</span>.fullName</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> filterTickers</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>In the tableview delegator or datasource, I replaced the old ones with<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> _tickers = tickers.milter(filterBy: <span class="keyword">self</span>.lowercasedSearchText,</span><br><span class="line">                              separatedBy: <span class="type">Section</span>(section: indexPath.section),</span><br><span class="line">                              sortedBy: _sorted)</span><br></pre></td></tr></table></figure></p>
<p>I cleaned my room, but the story wasn’t end. The sorting logic start from the user clicking on the section header. There are three section headers, one is for coin type, one is for tokens and the other is for my favorite list. And each of these section has three types of sorting. To keep this sorting statuses, I also introduced lots of “Variables” to present the status of sorting logic. These code snippet are scattering into several classes. If I didn’t check the code for some days and reviewed it again, I would almost forgot their relationship with the sorting logic.</p>
<p>The kline chart is embedded in the ExpandViewController, and the ExpandViewController is appeared in two view controllers, one is the price view controller, the other is the Favorite viewcontroller, so the ExpandViewController has two instances. And these instances have different life cycle. We change the kline datasource from the Setting view controller, this change can’t be conveyed to every one. There is no good method to cache this change, except using a global singleton object to store this status. That is why I created a class called “KLineSource”. Too many global object means disaster will come. But the MVC model, I have no choice, if I don’t want to keep this status in a lot of objects, and transfers this status from one object to the other one. It will be more uglily than the method before.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">KLineSource</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> shared = <span class="type">KLineSource</span>()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> dataSource = <span class="type">DataSource</span>.cryptoCompare</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">init</span>() &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>This is a simple demo application. So I only met these two main barriers. One is how to maintain relative statuses, and connect them effectively, some statuses are changed, some one will follow. Another is how to keep some statuses that we can access them convenience. I work around these issues, the codebase looks uglily now. And I have no idea how to test these code. So far I have finished the application under MVC pattern. You can check the code out here.</p>
<p>I think the MVVM pattern only brings us branch of new classes, if we don’t introduce the reactive framework. If we separate some logics from the massive view controllers, it will help us to test our application logic, but I am not sure about it is useful. Our real problem is how to synchronize these statuses distributed in different objects. The RxSwift give us a better solution to connect the statuses together. So I will jump to the MVVM w/ RxSwift in the next section. </p>
<h2 id="MVC-RxSwift"><a href="#MVC-RxSwift" class="headerlink" title="MVC-RxSwift"></a>MVC-RxSwift</h2><p><img src="/From-MVC-to-MVVM-C-Step-by-Step/Methods_For_Information_Flow.png" width="80%" margin-left="auto" margin-right="auto"><br><br>When I separate our application into different objects with MVC pattern, we need some methods to exchange informations betwen these objects. In Apple’s framework, there are seveval ways we can choice, from delegates, callback blocks, notifications, KVO, to target/action event observers. It is convenient for us to glue these objects together. But it is also confused to us. Sometimes how to choice what kind of technology is a challenge. The big problem is we aslo need to connnect these different asynchronization methods in an appropriate way. In this process, we might create more additional varables to keep the status of the applcation. </p>
<p>It’s time to introduce the RxSwift. In RxSwift, an Obseravble can emit a sequences of event. And this event contains some kind of value. RxSwift also provide lots of operators to convert and combine these events whatever you want. The different kinds of Subjects are powerful tools we can use to bond these sequences to create reactive chains. When we subscribe these sequences, we will get the responses automatically. </p>
<p>Though RxSwift is a powerful tool, but it seems like a totally different language. We need to change our minds to master the new language. And the learning curve of Swift is higher than learning Swift as an Objective-C programmer. Swift and Objective-C are different dialects in a same language. But when we use RxSwift, we just like talking with Alias. There is no shortcut to master the new language. Just use try and use it.</p>
<h4 id="How-to-encapsulate-networking-API-using-RxSwift"><a href="#How-to-encapsulate-networking-API-using-RxSwift" class="headerlink" title="How to encapsulate networking API using RxSwift"></a>How to encapsulate networking API using RxSwift</h4><p>The first thing to me is encapsulating callback methods in networking API with RxSwift Observable. I added a new function called <em>getDataFromEndPointRx</em> to convert the callback into an Observable. And the Observable is a disposable object, I put the cancel logic in a callback function when the disposable object is created. So when the Obseravble object is released, It will cancel the http request automatically. </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getDataFromEndPointRx</span>&lt;T: Decodable&gt;<span class="params">(<span class="number">_</span> endPoint: EndPoint,</span></span></span><br><span class="line"><span class="function"><span class="params">                         type: T.<span class="keyword">Type</span>)</span></span> -&gt; <span class="type">Observable</span>&lt;<span class="type">T</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">Observable</span>&lt;<span class="type">T</span>&gt;.create(&#123; observer <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">let</span> taskKey = <span class="keyword">self</span>.getDataFromEndPoint(endPoint, type: type) &#123;</span><br><span class="line">            (data, error) <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">if</span> error != <span class="literal">nil</span> &#123;</span><br><span class="line">                observer.onError(error!)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> _data = data <span class="keyword">as</span>? <span class="type">T</span> &#123;</span><br><span class="line">                observer.onNext(_data)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="type">Disposables</span>.create &#123;</span><br><span class="line">            <span class="keyword">self</span>.cancelRequestWithUniqueKey(taskKey)</span><br><span class="line">            <span class="keyword">self</span>.tasks.removeValue(forKey: taskKey)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getDataFromEndPoint</span>&lt;T: Decodable&gt;<span class="params">(<span class="number">_</span> endPoint: EndPoint,</span></span></span><br><span class="line"><span class="function"><span class="params">                                             type: T.<span class="keyword">Type</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                         networkManagerCompletion: @escaping NetworkManagerCompletion)</span></span> -&gt; taskId &#123;</span><br><span class="line">    <span class="keyword">let</span> task = router.request(endPoint) &#123; (data, response, error) <span class="keyword">in</span></span><br><span class="line">        <span class="type">DispatchQueue</span>.main.async &#123;</span><br><span class="line">            <span class="keyword">if</span> error != <span class="literal">nil</span> &#123;</span><br><span class="line">                networkManagerCompletion(<span class="literal">nil</span>, <span class="type">NetworkResponse</span>.failed)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> response = response <span class="keyword">as</span>? <span class="type">HTTPURLResponse</span> &#123;</span><br><span class="line">                <span class="keyword">let</span> result = <span class="keyword">self</span>.handleNetworkResponse(response)</span><br><span class="line">                <span class="keyword">switch</span> result &#123;</span><br><span class="line">                <span class="keyword">case</span> .success:</span><br><span class="line">                    <span class="keyword">guard</span> <span class="keyword">let</span> responseData = data <span class="keyword">else</span> &#123;</span><br><span class="line">                        networkManagerCompletion(<span class="literal">nil</span>, <span class="type">NetworkResponse</span>.noData)</span><br><span class="line">                        <span class="keyword">return</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">do</span> &#123;</span><br><span class="line">                        <span class="keyword">let</span> apiResponse = <span class="keyword">try</span> <span class="type">JSONDecoder</span>().decode(type.<span class="keyword">self</span>, from: responseData)</span><br><span class="line">                        networkManagerCompletion(apiResponse, <span class="literal">nil</span>)</span><br><span class="line">                    &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">                        networkManagerCompletion(<span class="literal">nil</span>, <span class="type">NetworkResponse</span>.unableTODecode)</span><br><span class="line">                    &#125;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    networkManagerCompletion(<span class="literal">nil</span>, result)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> taskId = <span class="type">NSUUID</span>().uuidString</span><br><span class="line">    tasks = [taskId: task]</span><br><span class="line">    <span class="keyword">return</span> taskId</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>In our application, we use Filesystem APIs to save our favorite cryptocurrencies. The Filesystem APIs are more like our networking APIs. We can use the same methodology to convert the Filesystem APIs into RxSwift Observables. But in this application, I didn’t do that, the main reason is our saved data is very small, and we can treat these APIs as synchronized function calls. So I think is not necessary for us to encapsulate them. I just subscrible the actions, and call these functions when the actions take place.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">_selectRemoveMyFavorites.subscribe(onNext: &#123;</span><br><span class="line">    <span class="keyword">self</span>.removeSavedJSONFileFromDisk()</span><br><span class="line">&#125;).disposed(by: disposeBag)</span><br></pre></td></tr></table></figure>
<h4 id="How-to-handle-the-error-events-emmited-from-networking-API-Materialize-and-Dematerialize"><a href="#How-to-handle-the-error-events-emmited-from-networking-API-Materialize-and-Dematerialize" class="headerlink" title="How to handle the error events emmited from networking API, Materialize and Dematerialize"></a>How to handle the error events emmited from networking API, Materialize and Dematerialize</h4><p>Our networking APIs have not the ability to handle the errors, they just conduct these errors from the bottom to the applcation layer. How to handle these errors is depended on uour application logic. Without RxSwift, every thing is ok. But when we convert the callback function into Observable onject, the chain will be broken, because I send the errors through the onError event. After the onError event is sent, the Observable object will be terminated, this is not we want, but we still want to get these error messages in the application layer. How can we get them? In RxSwift, they provide a mechanism called <em>Materialize</em>. It add a shell on the onError event, then this event turns into a normal event, and the error event become a value inside the normal event. Then we can use a filter operator to catch the error event when it happans. If it is not a error event, then the filter will <em>dematerialize</em> the event, we will get the original data again.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">huobiReload.withLatestFrom(symbol.asObservable())</span><br><span class="line">    &#123; (dataSource, symbol) <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">return</span> symbol</span><br><span class="line">    &#125;</span><br><span class="line">    .flatMap &#123; (symbol) -&gt;  <span class="type">Observable</span>&lt;<span class="type">Event</span>&lt;<span class="type">KlineResponse</span>&gt;&gt; <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">return</span> <span class="type">HuobiNetworkManager</span>.shared.getDataFromEndPointRx(.historyKline(symbol: symbol.lowercased() + <span class="string">"usdt"</span>, period: <span class="string">"5min"</span>, size: <span class="number">150</span>), type: <span class="type">KlineResponse</span>.<span class="keyword">self</span>).materialize()</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="built_in">filter</span> &#123; [<span class="keyword">unowned</span> <span class="keyword">self</span> ] <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">guard</span> $<span class="number">0</span>.error == <span class="literal">nil</span> <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">Log</span>.e(<span class="string">"Catch Error: +\($0.error!)"</span>)</span><br><span class="line">            <span class="keyword">self</span>.histoHourVolumes = <span class="type">Variable</span>&lt;[<span class="type">OHLCV</span>]&gt;([])</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    .dematerialize()</span><br><span class="line">    .<span class="built_in">map</span> &#123; (kLineResponse) -&gt; [<span class="type">KlineItem</span>] <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">return</span> kLineResponse.data</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="built_in">map</span> &#123; (kLineItems) -&gt; [<span class="type">OHLCV</span>] <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">var</span> ohlcvs = [<span class="type">OHLCV</span>]()</span><br><span class="line">        kLineItems.forEach(&#123; (kLineItem) <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">let</span> ohlcv = <span class="type">OHLCV</span>(time: <span class="number">0</span>, <span class="keyword">open</span>: kLineItem.<span class="keyword">open</span>!, close: kLineItem.close!, low: kLineItem.low!, high: kLineItem.high!, volumefrom: <span class="number">0.0</span>, volumeto: <span class="number">0.0</span>)</span><br><span class="line">            ohlcvs.append(ohlcv)</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">return</span> ohlcvs</span><br><span class="line">    &#125;</span><br><span class="line">    .bind(to: histoHourVolumes)</span><br><span class="line">    .disposed(by: disposeBag)</span><br></pre></td></tr></table></figure>
<p>The Houbi API need me to provide correct symbol name, but I get the symbol name of cryptocurrency from CoinMarket. Sometimes the names of these symbols are not One-to-one correspondence. In this demo application, I don’t want to handle this situation, So i will get an error return from the Huobi API, when I switch from CryptoCompare to the Huobi API. </p>
<h4 id="Use-RxSwift-Extensions-RxDataSource"><a href="#Use-RxSwift-Extensions-RxDataSource" class="headerlink" title="Use RxSwift Extensions: RxDataSource"></a>Use RxSwift Extensions: RxDataSource</h4><p>Now we get the data, we can bind these data to views. RxCocoa has already encapsulated lots of controls in UIKit, but it is not enough when we encount some complex controls like TableView or CollectionView. At this situation, we need to use the extension framework from RxSwift community. RxDataSource makes us work more easy. First we create a datasource which is comfirmed SectionModelType protocol. This datasource also define a callback how to config tableview cell when we get the datasource item.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">dataSource = <span class="type">RxTableViewSectionedReloadDataSource</span>&lt;<span class="type">SectionModel</span>&lt;<span class="type">String</span>, <span class="type">Ticker</span>&gt;&gt;(</span><br><span class="line">    configureCell: &#123; dataSource, tableView, indexPath, item <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">let</span> cell = tableView.dequeueReusableCell(withIdentifier: <span class="keyword">self</span>.cellIdentifier, <span class="keyword">for</span>: indexPath) <span class="keyword">as</span>! <span class="type">CurrencyCell</span></span><br><span class="line">        cell.selectionStyle = .<span class="keyword">none</span></span><br><span class="line">        cell.setCoinImage(item.imageUrl, with: (<span class="keyword">self</span>.baseImageUrl)!)</span><br><span class="line">        cell.setName(item.fullName)</span><br><span class="line">        cell.setPrice((item.quotes[<span class="string">"USD"</span>]?.price)!)</span><br><span class="line">        cell.setChange((item.quotes[<span class="string">"USD"</span>]?.percentChange24h)!)</span><br><span class="line">        cell.setVolume24h((item.quotes[<span class="string">"USD"</span>]?.volume24h)!)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">self</span>.currentUrlString = (<span class="keyword">self</span>.baseImageUrl)! + item.url</span><br><span class="line">        </span><br><span class="line">        cell.setWithExpand(<span class="keyword">self</span>.expandedIndexPaths.<span class="built_in">contains</span>(indexPath))</span><br></pre></td></tr></table></figure>
<p>After we get the data from Observable of the networking API, we map the event from the [Ticker] to [SectionModel&lt;String, Ticker&gt;], and bind this sections into the tableview. The RxDataSource solved our multi sections problem. </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Observable</span>.combineLatest(_coins, __tokens) &#123;</span><br><span class="line">    <span class="keyword">return</span> ($<span class="number">0</span>, $<span class="number">1</span>)</span><br><span class="line">&#125;</span><br><span class="line">.<span class="built_in">map</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> sections = [<span class="type">SectionModel</span>&lt;<span class="type">String</span>, <span class="type">Ticker</span>&gt;]()</span><br><span class="line">    <span class="keyword">if</span> $<span class="number">0</span>.<span class="built_in">count</span> != <span class="number">0</span> &#123;</span><br><span class="line">        sections.append(<span class="type">SectionModel</span>(model: <span class="string">"Coin"</span>, items: $<span class="number">0</span>))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> $<span class="number">1</span>.<span class="built_in">count</span> != <span class="number">0</span> &#123;</span><br><span class="line">        sections.append(<span class="type">SectionModel</span>(model: <span class="string">"Token"</span>, items: $<span class="number">1</span>))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> sections</span><br><span class="line">&#125;</span><br><span class="line">.bind(to: tableView.rx.items(dataSource: dataSource!))</span><br><span class="line">.disposed(by: disposeBag)</span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line"><span class="type">But</span> <span class="type">I</span> can not <span class="built_in">find</span> how to customize the section header view <span class="keyword">in</span> different sections. <span class="type">The</span> <span class="type">RxSwift</span> keeps the delegate solution <span class="keyword">for</span> some situation it can't handle. <span class="type">We</span> can <span class="keyword">set</span> a delegate to a tableview.rx, then the tableview still will call our delegate function <span class="keyword">in</span> the view controller. </span><br><span class="line"></span><br><span class="line">``` <span class="type">Swift</span></span><br><span class="line">dataSource?.canEditRowAtIndexPath = &#123; dataSource, indexPath <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">return</span> !<span class="keyword">self</span>.expandedIndexPaths.<span class="built_in">contains</span>(indexPath <span class="keyword">as</span> <span class="type">IndexPath</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">tableView.rx</span><br><span class="line">    .setDelegate(<span class="keyword">self</span>)</span><br><span class="line">    .disposed(by: disposeBag)</span><br></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">PricesViewController</span> </span>&#123;    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">tableView</span><span class="params">(<span class="number">_</span> tableView: UITableView, editActionsForRowAt indexPath: IndexPath)</span></span> -&gt; [<span class="type">UITableViewRowAction</span>]? &#123;</span><br><span class="line">        <span class="keyword">let</span> favoriteRowAction = <span class="type">UITableViewRowAction</span>(style: <span class="type">UITableViewRowAction</span>.<span class="type">Style</span>.<span class="keyword">default</span>, title: <span class="string">"Favorite"</span>, handler:&#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] action, indexpath <span class="keyword">in</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">guard</span> <span class="keyword">let</span> ticker = <span class="keyword">self</span>?.dataSource?[indexPath] <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">self</span>?.favoritesViewController.baseImageUrl = <span class="keyword">self</span>?.baseImageUrl</span><br><span class="line">            <span class="keyword">self</span>?.favoritesViewController.addTicker(ticker)</span><br><span class="line">        &#125;)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> [favoriteRowAction]</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">tableView</span><span class="params">(<span class="number">_</span> tableView: UITableView, viewForHeaderInSection section: Int)</span></span> -&gt; <span class="type">UIView</span>? &#123;</span><br><span class="line">        <span class="keyword">if</span> section == <span class="number">0</span> &amp;&amp; <span class="keyword">self</span>.coinSectionHeaderView == <span class="literal">nil</span> || section == <span class="number">1</span> &amp;&amp; <span class="keyword">self</span>.tokenSectionHeaderView == <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> headerView = <span class="keyword">super</span>.tableView(tableView, viewForHeaderInSection: section) <span class="keyword">as</span>? <span class="type">SectionHeaderView</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> section == <span class="number">0</span> &#123;</span><br><span class="line">                    headerView.section = <span class="type">SortSection</span>.coin</span><br><span class="line">                    <span class="keyword">self</span>.coinSectionHeaderView = headerView</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    headerView.section = <span class="type">SortSection</span>.token</span><br><span class="line">                    <span class="keyword">self</span>.tokenSectionHeaderView = headerView</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> headerView</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">self</span>.coinSectionHeaderView</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> section == <span class="number">0</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">self</span>.coinSectionHeaderView</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">self</span>.tokenSectionHeaderView</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Connect-all-Observables-and-Observers-together"><a href="#Connect-all-Observables-and-Observers-together" class="headerlink" title="Connect all Observables and Observers together"></a>Connect all Observables and Observers together</h4><p>Distinguishing from the MVC pattern, we connect all of the Observables and Observers together and gather all application logics like filtering, sorting and separating, etc in one place. I drew a whole diagram of these logics to show how different it is between using RxSwift and the MVC model.<br><img src="/From-MVC-to-MVVM-C-Step-by-Step/RxSwift_Chain.png" width="100%" margin-left="auto" margin-right="auto"><br></p>
<p>In same cases, I use <em>filter</em> operator to activate different path in the reactive chain. And using <em>withLatestFrom</em> operator to tigger one event by the other event. Changing Kline datasource is an event emitted from a segment control in the Setting ViewController, and showing the Kline need another event which is changing the symbol name. The <em>changing datasource event</em> will trigger the <em>changing symbol name</em> event. </p>
<p><img src="/From-MVC-to-MVVM-C-Step-by-Step/RxSwift_Chain_2.png" width="100%" margin-left="auto" margin-right="auto"><br></p>
<h4 id="Interaction-between-view-controllers-from-delegate-to-obserable-and-observer"><a href="#Interaction-between-view-controllers-from-delegate-to-obserable-and-observer" class="headerlink" title="Interaction between view controllers from delegate to obserable and observer"></a>Interaction between view controllers from delegate to obserable and observer</h4><p>After I established the reactive chains to replace the delegates in the view controllers, I deleted some of properties who refer to the data models in the Price View Controler and Favorite View Controller. And I don’t need to keep the intermedia statuses for the appplication logics, but It doesn’t mean we can remove all statuses, these statuses are useful in exchanging informations between view controllers. If the object owned by the view controller, I think you can use the Observable in the object through the property directly. But most of time, I need to create a stub in the target view controller like the Price View Controller, and bind this stub with the Observable in the source view controller like the Setting ViewController. When the SettingViewController is removed from the memory, the Variable showCoinOnly will be disconnected from its source and sleep. When the SettingViewController is created again, the connection will be rebuilt, and the showCoinOnly will resend the event from the SettingViewController to the filtering logic chain as a router.</p>
<p><img src="/From-MVC-to-MVVM-C-Step-by-Step/RxSwift_Chain_3.png" width="100%" margin-left="auto" margin-right="auto"><br></p>
<p>In this diagram, you can see I create a two way bind in the SettingViewCOntroller, the showCoinOnly in the PriceViewController will keep the status, when the SettingViewController is created again, the Switch will get the status again. But how to write a 2-way bind is confusing me, I just wrote the code below, but I don’t know why it didn’t cause the infinitive problem.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">showCoinOnlySwitch.rx.isOn.changed.debug()</span><br><span class="line">    .bind(to: _selectShowCoinOnly)</span><br><span class="line">    .disposed(by: disposeBag)</span><br><span class="line"></span><br><span class="line">didSelectShowCoinOnly.debug()</span><br><span class="line">    .bind(to: showCoinOnlySwitch.rx.isOn)</span><br><span class="line">    .disposed(by: disposeBag)</span><br></pre></td></tr></table></figure>
<p>And if you want to use 2-way bind in other place, you can create a generic funtion to handle this. </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">infix</span> <span class="keyword">operator</span> &lt;-&gt;</span><br><span class="line"></span><br><span class="line">@discardableResult <span class="function"><span class="keyword">func</span> &lt;-&gt;&lt;T&gt;<span class="params">(property: ControlProperty&lt;T&gt;, variable: Variable&lt;T&gt;)</span></span> -&gt; <span class="type">Disposable</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> variableToProperty = variable.asObservable()</span><br><span class="line">        .bind(to: property)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> propertyToVariable = property</span><br><span class="line">        .subscribe(</span><br><span class="line">            onNext: &#123; variable.value = $<span class="number">0</span> &#125;,</span><br><span class="line">            onCompleted: &#123; variableToProperty.dispose() &#125;</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="type">Disposables</span>.create(variableToProperty, propertyToVariable)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="The-Problems-I-met"><a href="#The-Problems-I-met" class="headerlink" title="The Problems I met"></a>The Problems I met</h4><h5 id="The-scope-of-a-status"><a href="#The-scope-of-a-status" class="headerlink" title="The scope of a status"></a>The scope of a status</h5><p>When I implement the application logic, I realize that there are three kinds of status I need to mantain. </p>
<ol>
<li>Local Status<br>To be honest there is no local status when we use the RxSwift, the RxSwift doesn’t keep the status, it just trigger events from the Observables and consume these events by the Observers. I use this terminology in order to distingush the other two statuses. </li>
<li>Status as a property<br>Just like I discuss in the last section, the showCoinOnly in the PriceViewCOntroller keep the status transfered from the SettingViewController. This Variable will share information between two view controllers, one will be released, the other is alway keeping in the memory. In this case I keep the status in the PriceViewcontroller, because, the PriceVIewController will not be released in the application whole life time.</li>
<li>Global status<br>But sometimes the two controllers who share inforamtion will all be released. So how can I keep the status like the KLineSource in this application. The KLineSource is produced from the SeetingViewController when a user select the datasource on the segment control, and the KLineSource si consumed by the ExpandViewController to determine which APIs will be called. But these two view controllers will be release at runtime. So where can I keep the status. In this demo example I create a singleton global object to keep this status called KLineSource. </li>
</ol>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">KLineSource</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> shared = <span class="type">KLineSource</span>()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> dataSource = <span class="type">Variable</span>&lt;<span class="type">DataSource</span>&gt;(<span class="type">DataSource</span>.cryptoCompare)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">init</span>() &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="How-to-initialize-the-RxSwift-reactive-chain-when-some-of-these-view-controllers-are-created-dynamically"><a href="#How-to-initialize-the-RxSwift-reactive-chain-when-some-of-these-view-controllers-are-created-dynamically" class="headerlink" title="How to initialize the RxSwift reactive chain when some of these view controllers are created dynamically"></a>How to initialize the RxSwift reactive chain when some of these view controllers are created dynamically</h5><p>Because some of these view controllers will be created dynamically, it bring<br>another problem what is the appropriate time to create a view controller, and when to bind the reaction chain. When we create a view controller and send a event to its Observer, it won’t get this event if it hasn’t band the the Observer first.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">prepare</span><span class="params">(<span class="keyword">for</span> segue: UIStoryboardSegue, sender: Any?)</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.prepare(<span class="keyword">for</span>: segue, sender: sender)</span><br><span class="line">    segue.destination.transitioningDelegate = <span class="keyword">self</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> navigationController = segue.destination <span class="keyword">as</span>? <span class="type">SettingsNavigationController</span>,</span><br><span class="line">        <span class="keyword">let</span> settingsViewController = navigationController.viewControllers.first <span class="keyword">as</span>? <span class="type">SettingsViewController</span> &#123;</span><br><span class="line"></span><br><span class="line">        settingsViewController.didSelectShowCoinOnly</span><br><span class="line">            .bind(to: showCoinOnly)</span><br><span class="line">            .disposed(by: disposeBag)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// FIXED: How to save the status</span></span><br><span class="line">        settingsViewController._selectShowCoinOnly.onNext(showCoinOnly.value)</span><br></pre></td></tr></table></figure>
<p>When the seague is triggered, the SettingViewControler will be created, and I will send the ShowCoinOnly status to the SettingViewController. But if I put the binding code in the ViewDidLoad() in the SettingViewController, this event will be discarded because when the event is being sent, the chain hasn’t been setup yet. So I need to move the setup logic into awakeFromNib(). And I also need to load the view objects first compulsively like the code below.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">awakeFromNib</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.awakeFromNib()</span><br><span class="line">    <span class="comment">// FIXED: How to save the status..., force load view</span></span><br><span class="line">    <span class="number">_</span> = <span class="keyword">self</span>.view</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> closeButton = <span class="type">UIBarButtonItem</span>(title: <span class="string">"Close"</span>, style: .plain, target: <span class="keyword">self</span>, action: <span class="literal">nil</span>)</span><br><span class="line">    <span class="keyword">self</span>.navigationItem.leftBarButtonItem = closeButton</span><br><span class="line">    </span><br><span class="line">    dataSourceSegment.selectedSegmentIndex = <span class="type">KLineSource</span>.shared.dataSource.value.rawValue</span><br><span class="line">    </span><br><span class="line">    setupBindings()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">&#125;</span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line"><span class="type">It</span> <span class="keyword">is</span> not very comfortable, <span class="type">I</span> didn't <span class="built_in">find</span> any other good solution before we use the coordinator. <span class="type">One</span> resposibilty of the coordinator <span class="keyword">is</span> maintaining the lifecycle of <span class="type">ViewModels</span> and the <span class="type">Controllers</span>. <span class="type">It</span> will be a solution to fix this issue. <span class="type">But</span> before we jump to the <span class="type">MVVM</span>-<span class="type">RxSwit</span>-<span class="type">Coordinator</span>, we must create the <span class="type">ViewModel</span> layer first.</span><br><span class="line"></span><br><span class="line">## <span class="type">Create</span> the <span class="type">ViewModels</span></span><br><span class="line"><span class="type">View</span> <span class="type">Models</span> are extracted from view controllers. <span class="type">The</span> process of building the view models <span class="keyword">is</span> separating our application logics from view controllers. <span class="type">The</span> view controller only keep the resposibilities <span class="keyword">for</span> </span><br><span class="line"><span class="number">1</span>. maintain lifecycle of it's views</span><br><span class="line"><span class="number">2</span>. create a view model</span><br><span class="line"><span class="number">3</span>. connect inputs and outputs of the view model to the view elements</span><br><span class="line">   </span><br><span class="line">&lt;img src=<span class="string">"/From-MVC-to-MVVM-C-Step-by-Step/MCVMVMV.gif"</span> width=<span class="string">"100%"</span> margin-<span class="keyword">left</span>=<span class="string">"auto"</span> margin-<span class="keyword">right</span>=<span class="string">"auto"</span>&gt;&lt;br&gt;   </span><br><span class="line">   </span><br><span class="line"><span class="type">View</span> models are not depending on view controllers. <span class="type">They</span> only include application logics, so they are easy to be tested.</span><br><span class="line"></span><br><span class="line"><span class="type">One</span> typical view model <span class="keyword">in</span> our demo <span class="keyword">is</span> the <span class="type">SettingViewModel</span>.</span><br><span class="line"></span><br><span class="line">``` <span class="type">Swift</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SettingViewModel</span> </span>&#123;</span><br><span class="line">    <span class="comment">// MARK: - Inputs</span></span><br><span class="line">    <span class="keyword">let</span> selectDataSource: <span class="type">AnyObserver</span>&lt;<span class="type">DataSource</span>&gt;</span><br><span class="line">    <span class="keyword">let</span> selectShowCoinOnly: <span class="type">AnyObserver</span>&lt;<span class="type">Bool</span>&gt;</span><br><span class="line">    <span class="keyword">let</span> removeMyFavorites: <span class="type">AnyObserver</span>&lt;<span class="type">Bool</span>&gt;</span><br><span class="line">    <span class="keyword">let</span> cancel: <span class="type">AnyObserver</span>&lt;<span class="type">Void</span>&gt;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// MARK: - Status</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// MARK: - Outputs</span></span><br><span class="line">    <span class="keyword">let</span> didSelectDataSource : <span class="type">Observable</span>&lt;<span class="type">DataSource</span>&gt;</span><br><span class="line">    <span class="keyword">let</span> didSelectShowCoinOnly: <span class="type">Observable</span>&lt;<span class="type">Bool</span>&gt;</span><br><span class="line">    <span class="keyword">let</span> didRemoveMyFavorites: <span class="type">Observable</span>&lt;<span class="type">Bool</span>&gt;</span><br><span class="line">    <span class="keyword">let</span> didCancel: <span class="type">Observable</span>&lt;<span class="type">Void</span>&gt;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> _selectShowCoinOnly = <span class="type">BehaviorSubject</span>&lt;<span class="type">Bool</span>&gt;(value: <span class="literal">false</span>)</span><br><span class="line">        <span class="keyword">self</span>.selectShowCoinOnly = _selectShowCoinOnly.asObserver()</span><br><span class="line">        <span class="keyword">self</span>.didSelectShowCoinOnly = _selectShowCoinOnly.asObservable()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> _removeMyFavorites = <span class="type">PublishSubject</span>&lt;<span class="type">Bool</span>&gt;()</span><br><span class="line">        <span class="keyword">self</span>.removeMyFavorites = _removeMyFavorites.asObserver()</span><br><span class="line">        <span class="keyword">self</span>.didRemoveMyFavorites = _removeMyFavorites.asObservable()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> _cancel = <span class="type">PublishSubject</span>&lt;<span class="type">Void</span>&gt;()</span><br><span class="line">        <span class="keyword">self</span>.cancel = _cancel.asObserver()</span><br><span class="line">        <span class="keyword">self</span>.didCancel = _cancel.asObservable()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> _selectDataSource = <span class="type">BehaviorSubject</span>&lt;<span class="type">DataSource</span>&gt;(value: <span class="type">DataSource</span>.cryptoCompare)</span><br><span class="line">        <span class="keyword">self</span>.selectDataSource = _selectDataSource.asObserver()</span><br><span class="line">        <span class="keyword">self</span>.didSelectDataSource = _selectDataSource.asObservable()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>We don’t have the coordinator yet, so the SettingViewController is still responsable for creating it’s view model and connecting the inputs and outputs of the view model to some view controls and inputs and outputs of other view controllers.</p>
<p>If we take a picture of the SettingViewModel, we can get the diagram below:</p>
<p><img src="/From-MVC-to-MVVM-C-Step-by-Step/ViewModel2.png" width="100%" margin-left="auto" margin-right="auto"><br> </p>
<p>In this diagram, you can see the main logic on the client side is included in the PriceViewModel. This view model is just one class, and rely on any other views and view controllers. So we can write a test for it easily. </p>
<h2 id="The-Fininal-Step-Build-a-coordinator-tree"><a href="#The-Fininal-Step-Build-a-coordinator-tree" class="headerlink" title="The Fininal Step, Build a coordinator tree."></a>The Fininal Step, Build a coordinator tree.</h2><p>I call it as a coordinator tree, because, all of our coordinators which corresponds their view controllers, and have parent-children relationship like view controllers. </p>
<p>The top node of this tree is the AppCoordinator, it contains two coordinators, one is PriceCoordinator and the other FavoriteCoordinator.</p>
<p>All coordinators are inherited from BaseCoordinator. The main job of a coordinator is </p>
<ol>
<li>create a view model </li>
<li>ceeate a view controller</li>
<li>inject the view model into the view controller</li>
<li>maintain the navigation between view controllers.</li>
</ol>
<p>The fourth one can be separated some sub-steps</p>
<ol>
<li>creat a target coordinator as an observable object</li>
<li>flatmap some of source coordinator obserable into the target observable, this process is most like calling a networking service. </li>
<li>bind the source coordinator input onto the target coordinator, so we can get the result from the target coordinator. </li>
</ol>
<p>The whole process looks like calling a asynchronization function, when we start a new coordinator. Every coordinator must comfirm the start() function. In this funtion the coordinator returns an Observable object for it’s source coordinator.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">start</span><span class="params">()</span></span> -&gt; <span class="type">Observable</span>&lt;<span class="type">Void</span>&gt; &#123;</span><br><span class="line">       <span class="keyword">let</span> navigationViewController0 = rootViewController.viewControllers![<span class="number">0</span>] <span class="keyword">as</span>! <span class="type">UINavigationController</span></span><br><span class="line">       <span class="keyword">let</span> viewController = navigationViewController0.viewControllers[<span class="number">0</span>] <span class="keyword">as</span>! <span class="type">PricesViewController</span></span><br><span class="line">       </span><br><span class="line">       <span class="keyword">let</span> navigationViewController1 = rootViewController.viewControllers![<span class="number">1</span>] <span class="keyword">as</span>! <span class="type">UINavigationController</span></span><br><span class="line">       <span class="keyword">let</span> favoritesViewController = navigationViewController1.viewControllers[<span class="number">0</span>] <span class="keyword">as</span>? <span class="type">FavoritesViewController</span></span><br><span class="line">       </span><br><span class="line">       <span class="keyword">let</span> viewModel = <span class="type">PriceViewModel</span>()</span><br><span class="line">       viewController.viewModel = viewModel</span><br><span class="line">       </span><br><span class="line">       <span class="keyword">let</span> showSettings = viewModel.showSettings</span><br><span class="line">           .flatMap &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] <span class="number">_</span> -&gt; <span class="type">Observable</span>&lt;<span class="type">SettingCoordinationResult</span>&gt; <span class="keyword">in</span></span><br><span class="line">               <span class="keyword">guard</span> <span class="keyword">let</span> `<span class="keyword">self</span>` = <span class="keyword">self</span> <span class="keyword">else</span> &#123; <span class="keyword">return</span> .empty() &#125;</span><br><span class="line">               <span class="keyword">return</span> <span class="keyword">self</span>.showSettings(on: viewController, with: viewModel)</span><br><span class="line">           &#125;.share()</span><br><span class="line">       </span><br><span class="line">       showSettings</span><br><span class="line">           .<span class="built_in">filter</span>(&#123;</span><br><span class="line">               <span class="keyword">if</span> <span class="keyword">case</span> .kLineDataSource = $<span class="number">0</span> &#123;</span><br><span class="line">                   <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">               &#125;</span><br><span class="line">               <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">           &#125;)</span><br><span class="line">           .<span class="built_in">map</span> &#123;</span><br><span class="line">               <span class="keyword">if</span> <span class="keyword">case</span> .kLineDataSource(<span class="keyword">let</span> value) = $<span class="number">0</span> &#123;</span><br><span class="line">                   <span class="keyword">return</span> value</span><br><span class="line">               &#125;</span><br><span class="line">               <span class="keyword">return</span> <span class="type">DataSource</span>.cryptoCompare</span><br><span class="line">           &#125;</span><br><span class="line">           .bind(to: <span class="type">GlobalStatus</span>.shared.klineDataSource)</span><br><span class="line">           .disposed(by: disposeBag)</span><br><span class="line">           </span><br><span class="line">       showSettings</span><br><span class="line">           .<span class="built_in">filter</span>(&#123;</span><br><span class="line">               <span class="keyword">if</span> <span class="keyword">case</span> .showCoinOnly = $<span class="number">0</span> &#123;</span><br><span class="line">                   <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">               &#125;</span><br><span class="line">               <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">           &#125;)</span><br><span class="line">           .<span class="built_in">map</span> &#123;</span><br><span class="line">               <span class="keyword">if</span> <span class="keyword">case</span> .showCoinOnly(<span class="keyword">let</span> value) = $<span class="number">0</span> &#123;</span><br><span class="line">                   <span class="keyword">return</span> value</span><br><span class="line">               &#125;</span><br><span class="line">               <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">           &#125;</span><br><span class="line">           .bind(to: viewModel.showCoinOnly)</span><br><span class="line">           .disposed(by: disposeBag)</span><br><span class="line">       </span><br><span class="line">       showSettings</span><br><span class="line">           .<span class="built_in">filter</span>(&#123;</span><br><span class="line">               <span class="keyword">if</span> <span class="keyword">case</span> .removeMyFavorites = $<span class="number">0</span> &#123;</span><br><span class="line">                   <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">               &#125;</span><br><span class="line">               <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">           &#125;)</span><br><span class="line">           .<span class="built_in">map</span> &#123;</span><br><span class="line">               <span class="keyword">if</span> <span class="keyword">case</span> .removeMyFavorites(<span class="keyword">let</span> value) = $<span class="number">0</span> &#123;</span><br><span class="line">                   <span class="keyword">return</span> value</span><br><span class="line">               &#125;</span><br><span class="line">               <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">           &#125;</span><br><span class="line">           .bind(to: (favoritesViewController?.viewModel.deleteFavoriteList)!)</span><br><span class="line">           .disposed(by: disposeBag)</span><br><span class="line">       </span><br><span class="line">       </span><br><span class="line">       window.makeKeyAndVisible()</span><br><span class="line">       </span><br><span class="line">       <span class="keyword">return</span> <span class="type">Observable</span>.never()</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">showSettings</span><span class="params">(on rootViewController: UIViewController, with rootViewModel: PriceViewModel)</span></span> -&gt; <span class="type">Observable</span>&lt;<span class="type">SettingCoordinationResult</span>&gt; &#123;</span><br><span class="line">       <span class="keyword">let</span> settingsCoordinator = <span class="type">SettingCoordinator</span>(rootViewController: rootViewController, rootViewModel: rootViewModel)</span><br><span class="line">       <span class="keyword">return</span> coordinate(to: settingsCoordinator)</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>The relationship between these objects is showed in the figure below:</p>
<p><img src="/From-MVC-to-MVVM-C-Step-by-Step/Coordinator_ Asynchronous_Call.png" width="100%" margin-left="auto" margin-right="auto"><br> </p>
<p>So far we have finished our demo example. It is not a real project, but it is also not very simple. I show you how to refactor the code from MVC pattern to MVVM-Coordinator pattern. And this example also includes some key points to write a iOS application, such as networking service, autolayout, …</p>
<p>I hope it is helpful for the newbs in iOS develepment.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.magicefire.com/What’s-it-like-to-ride-in-a-self-driving-car/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Qubo Qin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Qubo Qin's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/What’s-it-like-to-ride-in-a-self-driving-car/" itemprop="url">What’s it like to ride in a self-driving car?</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-08-01T10:29:43-07:00">
                2018-08-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Tech/" itemprop="url" rel="index">
                    <span itemprop="name">Tech</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>这是一篇引用 <a href="https://medium.com/" target="_blank" rel="noopener">Medium</a>上<a href="https://medium.economist.com/@tomstandage" target="_blank" rel="noopener">Tom Standage</a>最新关于无人驾驶的文章.</p>
<h1 id="What’s-it-like-to-ride-in-a-self-driving-car"><a href="#What’s-it-like-to-ride-in-a-self-driving-car" class="headerlink" title="What’s it like to ride in a self-driving car?"></a><a href="https://medium.economist.com/whats-it-like-to-ride-in-a-self-driving-car-24015c69cc48" target="_blank" rel="noopener">What’s it like to ride in a self-driving car?</a></h1><h1 id="乘坐无人驾驶车是一种什么感觉？"><a href="#乘坐无人驾驶车是一种什么感觉？" class="headerlink" title="乘坐无人驾驶车是一种什么感觉？"></a>乘坐无人驾驶车是一种什么感觉？</h1><p>It’s thrilling for a minute or two, and then boring. Which is a good thing<br>头两分钟先是兴奋, 然后就感到无聊. 但这应该是一个好事</p>

<p>Where we’re going, we don’t need steering wheels<br>我们打算去哪里, 我们不需要方向盘</p>
<p><strong>Autonomous vehicles (AVs) are one of the most talked-about technologies of the moment.</strong> And little wonder: they promise to revolutionise the transport of people, and physical goods, just as dramatically as the internet transformed the delivery of information. But they raise many questions. When will they be available? Will they be safe? Will they make car-ownership obsolete? And most of all: what is it like to ride in a car that drives itself?</p>
<blockquote>
<p>无人驾驶是目前谈论的最多(最热门)的技术之一. 并不奇怪: 就像互联网改变了信息的传播方式一样的戏剧性, 无人驾驶技术承诺给人员和货物的运输带来革命性的巨变的同时也带来了诸多疑问. 这些技术啥时候成熟? 它们安全吗? 它们会使人们不再需要对车辆有拥有权吗? 这其中最重要的问题是: 乘坐自动驾驶的车辆到底是一种怎样的体验?</p>
</blockquote>
<p><strong>I’ve spent the past few months working on a 10,000-word special report on AVs for The Economist, which was published in this week’s issue.</strong> The focus of my report is mostly on the long-term implications of AVs, based on the assumption (a reasonable one, I think) that the technology can be made to work reliably in the next few years. Rather than focusing on the minutiae of things like the ever-changing industry alliances, or who is suing who, I concentrated instead on the impact on urban planning, the transformation of retailing and the broader social and political implications of cars that can drive themselves. I spoke to as many urban planners and social historians as machine-learning experts or car-industry executives. All this horizon-scanning and future-gazing was fun. But to kick off the report, I had to actually go in a self-driving car. Which is how I found myself, on a snowy morning a few weeks ago, standing in a car park in Pittsburgh, waiting for an automated ride.</p>
<blockquote>
<p>我已经花了几个月的时间为”经济学人”准备一份关于无人驾驶车辆10,000字的特别报告, 这份报告会在本周发表. 基于技术在今后的几年内应该变得更加成熟的假设(这是一个合理的假设), 我的这份报告主要关注点在于无人驾驶(对我们的)长期影响. 与其去关注那些细枝末节的事情, 例如不断变化的行业联盟, 或者谁起诉了谁, 我更加关注无人驾驶车辆对城市规划的影响, 对零售业的改变和对更广泛的社会和政治的影响. 我和很多城市规划者, 社会历史学家, 也包括机器学习专家, 汽车行业的高管交谈过. 所有这些全方位的审视和对未来的展望都非常有趣. 但是抛开这份报告, 我觉得我更有必要坐进一辆无人驾驶的车里. 这就是为啥, 在前几周的一个下雪的早上, 我发现自己站在匹兹堡的一个停车场, 等待一次无人驾驶的体验.</p>
</blockquote>
<p><strong>Three years ago I went in a self-driving car in Shanghai.</strong> It was quite a basic example: what is known in the field as a “Level 2” vehicle. This means it can steer itself, and maintain a safe distance from the car in front, while driving in highway traffic. I rode in an Audi A7, and a few cars now on the market (notably those made by Tesla) are capable of Level 2 automation. But the driver is required to keep hands on or near the wheel, and to pay attention to the surroundings, in case anything unexpected happens. With the next level up, Level 3, the car takes more responsibility for monitoring its surroundings, allowing the driver to relax a bit more. But if the car encounters a situation it cannot deal with, it sounds a warning telling the driver to resume control. The first Level 3 vehicle, the Audi A8, goes on sale this year.</p>
<blockquote>
<p>三年前我在上海尝试过一辆无人驾驶汽车. 那是一辆最基本的样车: 在这个领域内作为”Level 2”的车辆. 这意味着它可以在高速公路上自动驾驶, 并保持于前方车辆一定的安全距离. 当时我乘坐的是一辆Audi A7, 现在市场上达到Level 2的车辆有好一些了(尤其是Tesla生产的). 但是驾驶员需要把手放在方向盘上或靠近方向盘的地方, 并且注意周围的环境, 才能应对任何不可预期的事情发生. 再上一个级别的, 就是Level 3, 这类的车辆可以监控它周围环境时承担更多的责任, 让驾驶员更加的轻松. 但是如果这类车辆遇到它不能处理的情况, 就会发出警告的声音用来提醒驾驶员恢复控制. 第一辆Level 3的车辆, Audi A8, 今年会开卖.</p>
</blockquote>
<p><strong>Level 2 and Level 3 are really just glorified forms of cruise control.</strong> A truly self-driving vehicle doesn’t just follow the road ahead of it. It does route-planning and knows where it’s going. It handles junctions, crossings, traffic lights and road signs, and interacts smoothly with other vehicles, pedestrians and cyclists. This is, to say the least, a big leap. A Level 4 vehicle is defined as one that can do all of this, without any input from a human driver, within a limited area: in practice, a city neighbourhood that has been mapped in very fine detail, to give the car a big head start in understanding its surroundings. A Level 5 vehicle (something that does not yet exist) is one that can in theory drive anywhere, like a human driver. That may be an unattainable goal: some people dislike driving at night, or in snow, and I would not volunteer to drive a car in Delhi unless I really had to. The upshot is that the most advanced AVs on the roads today are generally Level 4 vehicles that operate within specific regions of particular cities.</p>
<blockquote>
<p>Level 2和Level 3基本上就是定速巡航的增强形式. 真正的无人驾驶汽车不仅仅是沿着路, 朝前开而已. 它也要规划路线, 并且知道它打算去哪里. 它可以处理遇到车辆汇入点, 十字路口, 交通信号灯和路面的标志时的各种状况, 并且和路面上的其他车辆, 行人和自行车平稳的互动. 这个至少才可以说是一个巨大的飞跃. 在一个被限定的区域内, Level 4的无人驾驶车辆就是可以在没有任何人类驾驶员干预的条件下完成上述所有目标的车辆. 这个被限定的区域实际上就是已经被精细的绘制在地图上的城市, 这让我们的无人驾驶车辆在理解它的周围环境中有了一个很好的开端. Level 5的无人驾驶车辆(目前还不存在)就是那种理论上可以在任何地方无人驾驶的车辆, 就像人类驾驶员一样. 这也许是一个无法达成的目标: 有些人不喜欢在夜间开车, 或下雪的时候开车, 同样我也不愿意在”Delhi”自愿开车, 除非迫不得已. 结果就是目前路上最先进的无人驾驶车辆只是一般意义上的第4代无人驾驶车辆, 只能在特定的城市的指定区域驾驶.</p>
</blockquote>
<p><strong>Different cities offer different testing environments.</strong> Phoenix, Arizona is popular because it has a regular grid system and reliably good weather (snow can confuse the LIDAR sensors that AVs use to scan their surroundings). AVs can also be seen on the roads in and around Mountain View, for similar reasons, and because so many technology firms are based in the Bay Area. The early history of self-driving vehicles was shaped by the rivalry between Stanford University in California and Carnegie Mellon University in Pittsburgh, which have produced many of the engineers now leading AV projects around the world. This has made Pittsburgh another hub of AV research and testing. The city is considered a more challenging environment than Phoenix, because its road layout is more complex, and the weather is worse. San Francisco’s urban environment is particularly complex, which is why Kyle Vogt, the boss of Cruise, an AV startup acquired by General Motors, says it is the best place for testing (check out his blog post for some very impressive video footage). If you can make it there, you might say, you can make it anywhere.</p>
<blockquote>
<p>不同的城市提供不同的测试环境. 亚利桑那的凤凰城比较受欢迎, 是因为它有着规则的网格道路和好天气(大雪可以让无人驾驶车辆扫描他们周围环境的LIDAR传感器失灵). 基于同样的理由, 我们也可以在山景城的路上看到无人驾驶车辆, 也是因为太多的技术公司都在湾区. 无人驾驶的早起历史是由加州的斯坦福大学和匹兹堡的卡内基梅隆大学竞争而形成的, 这给现在的世界输出了大量的工程师来引导无人驾驶的项目. 这点也让匹兹堡成为另外一个无人驾驶的研究和测试中心. 这座城市具有被认为比凤凰城更具有挑战的环境, 因为它的马路的布局更加复杂, 并且天气情况更加恶劣. 旧金山的市区的环境也是特别复杂, 直就是为啥被通用汽车收购的无人驾驶创业公司的老板Kyle Vogt, 认为它是最佳的测试地点(你可以在他的博客上找到很多印象深刻的视频短片). 如果你在旧金山可以搞定, 你可以说你可以在任何地方搞定无人驾驶.</p>
</blockquote>

<p>A self-driving Uber vehicle. That round thing on the top is the LIDAR sensor.</p>
<p><strong>Anyway, back to Pittsburgh. Uber has hired a lot of engineers from Carnegie Mellon, and Uber’s Advanced Technologies Group, which is developing its self-driving cars, is based in the city.</strong> The vehicle I climbed into was a modified Volvo XC90, with a bundle of extra sensors, including cameras and a spinning LIDAR unit, on its roof. Ryan, the vehicle’s safety driver, manually drove the vehicle out of the car park and onto the public roads, before pressing a button to engage the self-driving system. And then the car started driving itself.</p>
<blockquote>
<p>不管怎么说, 先回到让我们先回到匹兹堡. Uber已经从卡内基梅隆雇佣了大量的工程师, Uber开发它无人驾驶车辆的技术团队也坐落在匹兹堡. 我爬进去的是一辆根据Volvo XC90改造的车辆, 车顶上带着一堆外置的传感器, 包括摄像头和可以转动的LIDAR单元. Ryan, 这辆车的安全驾驶员, 在按下一个按钮启动自动驾驶系统之前, 他驾驶这辆车从停车场开出来, 并且开到马路上. 然后这辆车才开始靠它自己驾驶.</p>
</blockquote>
<p><strong>At first, the experience is thrilling. It seems like magic when the steering wheel turns by itself, or the car gently slows to a halt at a traffic light.</strong> The autonomous Uber drove carefully but confidently in downtown traffic and light snow, slowing down when passing a school or approaching the brow of a hill, and putting its foot down (as it were) when faced with an open, straight road with no other traffic. The most noticeable difference from a human driver was that the vehicle made no attempt to avoid Pittsburgh’s notorious potholes, making the ride slightly bumpy at times. Sitting in the back seat, I could see a digital representation, displayed on an iPad mounted between the front seats, of how the car perceived the world, with other vehicles, pedestrians and cyclists highlighted in clusters of blue dots. I felt as though I was living in the future. But then, after a minute or two, the novelty wore off. When technology works as expected, it’s boring.</p>
<blockquote>
<p>起初的体验是很激动人心的. 当方向盘自己转动的时候, 或者这辆车渐渐的减速停在交通信号灯前, 使它看上去像魔法. 这个无人驾驶的Uber在市中心拥挤的交通和小雪的情况下小心并自信的驾驶着, 当通过学校或接近山顶的时候会降低自己的速度, 并且在遇到开阔的没有其他车辆的直行道路上, 它会踩下油门(就好像踩下油门). 和人类司机相比较最大的区别就是这辆车没有试图躲避匹兹堡名声狼藉的坑坑洼洼, 使整个驾驶过程有些轻微的颠簸. 坐在后排, 我可以看见一个数字仪表盘, 显示在一个安装在前排座椅中的的iPad上, 用高亮的一组蓝点标记其他车辆, 行人和自行车, 展现无人驾驶的Uber是如何观察这个世界的. 我感觉自己就像生活在未来世界. 但是过了几分钟, 新奇感就消失了, 技术如预期的工作, 它是显得很枯燥了.</p>
</blockquote>

<p>How the car sees the world. Objects of particular interest are shown in blue.</p>
<p><strong>This is, in fact, exactly the reaction that engineers are hoping for. Noah Zych, Uber’s head of system safety for autonomous cars, told me that after working on AVs for ten years, he was finally able to offer his parents a ride in a self-driving car last year when they came to visit.</strong> After their ride ended, he asked them what they thought of it. “And my mom said, ‘actually, it was kind of boring’. And that’s the response that we really want,” he says. Uber has offered some riders in Pittsburgh and Phoenix the option to travel in its self-driving vehicles, provided the start and end points of their ride fall within their area of operation. (Riders can say no if they want to.) Around 50,000 people have travelled in Uber’s self-driving cars in the past couple of years. Uber wants to understand how to design the in-car experience (such as what information should be shown on the screen), and it also wants to reassure both riders and other road-users about the safety of autonomous vehicles. “The best way to convince people that a self-driving vehicle is going to be safe and capable of driving them around in the future is to give them that first experience,” says Mr Zych.</p>
<blockquote>
<p>事实上, 这是工程师们期待的反馈. Noah Zych, Uber自动驾驶系统安全部门的头, 他告诉我他的无人驾驶领域工作了十年后, 他终于可以给来去年来参观的父母提供一次无人驾驶的乘坐体验. 试乘体验之后, 他问他们的感受. “然后我母亲说, ‘事实上, 有些无聊’, 这就是我们想要的反馈,”. Uber已经为在匹兹堡和凤凰城的一些车手提供无人驾驶车辆的选择, 只要他们提供的驾驶的起始点和终点落在可以操作的区域内. (驾驶者可以说不, 如果他们想这样的话). 在过去的几年里, 大概有50,000左右的人已经参与了Uber的无人驾驶体验. 通过这些反馈, Uber想知道如何设计车内的体验(例如怎样的信息应该被展示到屏幕上), 并且它也想让乘客和路人对无人驾驶感到放心. Mr Zych说, “最好的方式说服人们无人驾驶的车辆在未来会变得越来越安全就是给他们提供一手的体验”.</p>
</blockquote>
<p><strong>Ryan, the safety driver in my self-driving Uber, had to take over occasionally, for example to steer the car around a delivery truck that had blocked the road — the car was programmed to play things safe and wait, rather than cross the double-yellow lines in the middle of the road — and to guide the car through roadworks where the lane markings had been recently changed.</strong> A couple of times he also took over when the car looked as though it might be passing a bit too close to another vehicle. In each case a collision was unlikely, Ryan explained, but if people think a collision is imminent, they will not feel safe. So part of his job is to flag up instances where the car’s driving style could be tweaked to provide a better experience for passengers. At the end of each day, the contents of the car’s on-board computers are downloaded for analysis. Each time the safety driver had to take over — an event known as a “disengagement” — the corresponding data can be analysed to see how the car’s software could be improved. It is then possible to simulate how the car would have responded with various modifications to its algorithms. “We can play it back again and again, vary the scenario and see the distribution of outcomes,” says Mr Zych. After being tested in simulation, the improved software is then rolled out in real vehicles. It is first tested on a small subset of routes, called “canonical” routes, which test different aspects of its behaviour. If it works as expected, the software is then rolled out for general use.</p>
<blockquote>
<p>Ryan, 是我的自动驾驶车里的安全司机, 有时候不得不主动接管车辆, 举例来说, 驾驶车辆绕开挡住马路的一辆卸货卡车 - (遇到这种情况)这辆自动驾驶的车辆被设定保持尽可能的安全, 并且进入等待状态, 而不是穿过马路中间的双黄线 - 并引导车辆通过最近改变车道标线的道路工程. 有几次, 当这辆车子看上去好像和其他车辆过于接近的时候, 他也接管了驾驶. Ryan解释到, 碰撞的情况其实是不会发生的, 但是如果人们认为碰撞将要发生, 他们会感到不安全. 为了给乘客提供更好的体验, 他的部分工作就是在这辆车驾驶风格中可以微调的地方标记这些实例. 每天工作结束前, 这辆车子的车载电脑上的内容会被下载下来用以分析. 每次安全司机不得不介入的情况被认定为一次”脱靶” - 对应的数据可以被分析用来如何改进这辆车的软件. 这样就可以模拟如何让车辆通过对算法的改进来做出不同的响应. 在模拟环境中测试之后, 改进的软件会在真实的车辆中更新. 我们可以一次又一次地回放，改变场景并查看结果的分布. 首次测试会在线路选取较小的子集进行, 称之为”标准的”线路, 用来测试软件的不同方面. 如果按照预期的工作, 软件会正式升级.</p>
</blockquote>
<p><strong>I spent most of my hour in a self-driving Uber discussing disengagements, algorithm design and user interfaces, which (to me, at least) are just as exciting as being in a futuristic robocar.</strong> And even when the driving algorithms are working perfectly, there are several practical questions that still have to be addressed. For example, how will people actually hail driverless vehicles? They can’t just stop anywhere, or they will block traffic and annoy people. Human drivers can pick a good place to stop, but machines will need help. Uber has already started identifying good pick-up and drop-off points in some cities, and suggesting them to riders of human-driven vehicles. But it may be that in future, streets will have designated pick-up and drop-off areas; already, some university campuses and apartment blocks are being built with ride-hailing in mind. And how will a self-driving vehicle be able to tell that everyone is on board and ready to go? Some kind of “start” button will be needed — and a “stop” button, too, in case a rider suddenly wants to get out of the vehicle. (The driverless Uber has a “pull over” button for this.)</p>
<blockquote>
<p>我在这辆自动驾驶的Uber上花了大量的时间(和Ryan)讨论”脱靶”的情况, 算法设计和用户界面, 这些对于我来说和在一辆未来的robocar一样激动人心. 然而即使当驾驶算法可以完美的工作, 这里仍然有一些实际的问题需要被解决. 举例来说, 将来人们如何和无人驾驶车辆打招呼? 它们不可以随便停车, 否则它们会阻塞交通并且干扰人们(的正常活动).无人驾驶车辆如何能够告诉车上的乘客准备出发? 某种类型的”开始”按钮还是需要的 - 当乘客忽然想下车的时候, “停止”按钮也是需要的. 但是或许不久的将来, 街道会重新设计上客和下客的区域. 人类的司机可以选择一个最佳的地方停车, 但是机器仍然需要协助. Uber已经开始在某些城市标识理想的上客和下客的位置, 并且建议他们乘坐人类驾车辆. 已经有一些大学校园和公寓大楼正在建设中(with ride-hailing in mind). (无人驾驶的Uber有一个”靠边停车的”按钮来对应这种情况).</p>
</blockquote>
<p><strong>Waymo, the self-driving unit of Google’s parent company, hopes to launch a robotaxi service in Phoenix later this year.</strong> Waymo has the lowest disengagement rate in the industry, and is generally considered the leader in the field; its autonomous vehicles can now operate in Phoenix without the need for safety drivers. GM’s Cruise, which is fast catching up with Waymo, hopes to launch a robotaxi service in 2019, using autonomous Chevy Bolts that do not have a steering wheel, pedals or any other kind of manual controls. So they, too, will have to be able to operate entirely autonomously without a safety driver. Dozens of other firms are also working on self-driving vehicles. Over the coming months and years more AVs will take to the roads in more cities, and the areas in which they operate will gradually expand. Probably sometime in the 2020s, you will take your first ride in a self-driving car. It will be exciting at first — but then, if all goes well, it should quickly become reassuringly boring.</p>
<blockquote>
<p>在今后的几年里, Waymo, Google母公司的自动驾驶部门, 打算在凤凰城提供无人驾驶的出租车服务. 在业界, Waymo的”脱靶”率是最低的, 并且被公认为这个领域内的领导者; 通用汽车的Cruise, 是最接近Waymo技术的, 他们希望在2019年提供无人驾驶的出租车服务, 使用自动驾驶的Chevy Bolt, 这种车没有方向盘, 踏板和其他各种手动控制的东西. 所以它们将不得不在没有安全司机的情况下完全自动驾驶. 一堆其他的公司都正在研发自动驾驶的车辆. 在今后的几个月里和几年内, 更多的无人驾驶车辆将会在更多的城市里上路, 并且它们的行驶范围会更加广阔. 有可能在2020年, 你可以在无人驾驶的车辆. 它首先将会是兴奋的, 然后, 如果它运行正常, 它会变得让人踏实的无聊.</p>
</blockquote>
<p>Waymo’s fully self-driving cars are here<br><div class="video-container"><iframe src="//www.youtube.com/embed/aaOB-ErYq6Y" frameborder="0" allowfullscreen></iframe></div></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.magicefire.com/english-grammar/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Qubo Qin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Qubo Qin's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/english-grammar/" itemprop="url">English Grammar</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-07-29T12:32:47-07:00">
                2018-07-29
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/english/" itemprop="url" rel="index">
                    <span itemprop="name">english</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Table-of-Contents"><a href="#Table-of-Contents" class="headerlink" title="Table of Contents"></a>Table of Contents</h1><ol>
<li><a href="#overview">Overview</a></li>
<li><a href="#sentences-complements">Sentences &amp; Complements</a></li>
<li><a href="#patterns-conversion">Patterns Conversion</a></li>
<li><a href="#verb-tenses">Verb Tenses - Time(时) &amp; Aspect(态)</a></li>
<li><a href="#verbals">Verbals</a></li>
<li><a href="#moods">Moods</a></li>
<li><a href="#reduced-clauses">Reduced Clauses</a></li>
<li><a href="#preposition">Preposition</a></li>
<li><a href="#article">Article</a></li>
</ol>
<h2 id="I-Overview"><a href="#I-Overview" class="headerlink" title="I. Overview"></a><a name="overview">I. Overview</a></h2><img src="/english-grammar/grammar_overview.png">
<ul>
<li>This is my english grammar note depended on <strong>旋元佑先生</strong>的<strong>&lt;&lt;英语魔法师之语法俱乐部&gt;&gt;</strong></li>
<li>以下笔记是学习<strong>旋元佑先生</strong>的<strong>&lt;&lt;英语魔法师之语法俱乐部&gt;&gt;</strong>的学习笔记</li>
</ul>
<h2 id="II-Sentences-amp-Complements"><a href="#II-Sentences-amp-Complements" class="headerlink" title="II. Sentences &amp; Complements"></a><a name="sentences-complements">II. Sentences &amp; Complements</a></h2><h4 id="A-Five-different-verbs-correspond-to-five-basic-sentence-patterns-五种不同特性的动词对应五种基本句型"><a href="#A-Five-different-verbs-correspond-to-five-basic-sentence-patterns-五种不同特性的动词对应五种基本句型" class="headerlink" title="A. Five different verbs correspond to five basic sentence patterns (五种不同特性的动词对应五种基本句型)"></a>A. Five different verbs correspond to five basic sentence patterns (五种不同特性的动词对应五种基本句型)</h4><img src="/english-grammar/sentence_pattern.png">
<h5 id="a-S-V-Intransitive-Verb"><a href="#a-S-V-Intransitive-Verb" class="headerlink" title="a. S+V (Intransitive Verb)"></a>a. S+V (Intransitive Verb)</h5><ol>
<li>John Smith died in World War Two.</li>
</ol>
<h5 id="b-S-V-Transitive-Verb-O"><a href="#b-S-V-Transitive-Verb-O" class="headerlink" title="b. S+V (Transitive Verb)+O"></a>b. S+V (Transitive Verb)+O</h5><ol>
<li>John Smith killed three enemy soldiers.</li>
</ol>
<h5 id="c-S-V-Transitive-Verb-O-O"><a href="#c-S-V-Transitive-Verb-O-O" class="headerlink" title="c. S+V (Transitive Verb)+O+O"></a>c. S+V (Transitive Verb)+O+O</h5><ol>
<li><span style="color:red">John‘s father gave him a dog.</span></li>
</ol>
<h5 id="d-S-V-Linking-Verb-C"><a href="#d-S-V-Linking-Verb-C" class="headerlink" title="d. S+V (Linking Verb)+C"></a>d. S+V (Linking Verb)+C</h5><ol>
<li>The soup is too hot.</li>
<li>John Smith was a soldier.</li>
<li>John Smith was courageous.</li>
<li><span style="color:blue">I feel sick.</span></li>
</ol>
<h5 id="e-S-V-Linking-Verb-O-C"><a href="#e-S-V-Linking-Verb-O-C" class="headerlink" title="e. S+V (Linking Verb)+O+C"></a>e. S+V (Linking Verb)+O+C</h5><ol>
<li><span style="color:blue">The food made me sick.</span></li>
<li>Most people consider a nurse a good wife.</li>
<li>I find the dress pretty.</li>
<li>The meat made the dog friendly.</li>
<li><span style="color:red">John’s father called him a dog.</span></li>
<li>His college training made him a teacher.</li>
<li>I don’t find the drug bitter.</li>
<li>I consider the story false.</li>
<li>He found the trip exciting.</li>
</ol>
<h4 id="B-What-are-Linking-Verbs-Followed-by-Complements-or-Objects-Complements-（链接动词跟补语）"><a href="#B-What-are-Linking-Verbs-Followed-by-Complements-or-Objects-Complements-（链接动词跟补语）" class="headerlink" title="B. What are Linking Verbs (Followed by Complements or Objects + Complements) （链接动词跟补语）"></a>B. What are Linking Verbs (Followed by Complements or Objects + Complements) （链接动词跟补语）</h4><p>In English, linking verbs can not be omitted. But when we translate them into Chinese, and also if the complements are adjectives, “是” will be omitted. (英语中Be动词在句子中不能省略, 但翻译成中文，如果补语是形容词，“是”会被丢弃)</p>
<ol>
<li>Taroko Gorge is beautiful. Taroko Gorge <del>_是_</del> 美丽的</li>
<li>The soup is too hot. 汤 <del>_是_</del> 太烫了</li>
</ol>
<p>In addition to ‘Be’, What else are Linking Verbs.(除了Be, 还有哪些Linking Verb)</p>
<table>
<thead>
<tr>
<th>是</th>
<th>Example</th>
<th>为(是的文言文)</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>look</td>
<td>That dress looks pretty.</td>
<td>turn(转变为)</td>
<td></td>
</tr>
<tr>
<td>seem(似乎是)</td>
<td>The dog seems friendly.</td>
<td>prove(证实为)</td>
<td>The story proved false.</td>
</tr>
<tr>
<td>appear(显得是)</td>
<td>His demands appear reasonable.</td>
<td>become(成为)</td>
<td>He became a teacher.</td>
</tr>
<tr>
<td>sound</td>
<td>His trip sounds exciting.</td>
<td>make(作为)</td>
<td>A nurse make a good wife.</td>
</tr>
<tr>
<td>feel</td>
<td>I feel sick.</td>
<td></td>
<td></td>
</tr>
<tr>
<td>taste</td>
<td>The drug tastes bitter.</td>
<td></td>
</tr>
</tbody>
</table>
<p>Because these linking Verbs themselves have no abilities to describe something detail, so we must use complements to make sentences completed. There are two types of words can be complements. (Linking Verb本身没有叙述能力, 需要用Complement补足句子, 补语有两种词类)</p>
<ol>
<li>noun - the same relationship with the subject (表达与主语的同等关系)</li>
<li>adjective</li>
</ol>
<h4 id="C-When-“Be”-is-not-a-Linking-Verb-Be不作为Linking-Verb-不解释为”是-而是要解释为”存在”-用在S-V句型中"><a href="#C-When-“Be”-is-not-a-Linking-Verb-Be不作为Linking-Verb-不解释为”是-而是要解释为”存在”-用在S-V句型中" class="headerlink" title="C. When “Be” is not a Linking Verb (Be不作为Linking Verb, 不解释为”是, 而是要解释为”存在”, 用在S+V句型中)"></a>C. When “Be” is not a Linking Verb (Be不作为<strong>Linking Verb</strong>, 不解释为”是, 而是要解释为”存在”, 用在S+V句型中)</h4><ol>
<li>I think, therefore I am. (René Descartes, 笛卡儿)</li>
<li>To be or not to be, that is the question. (@Hamlet, 哈姆雷特)</li>
</ol>
<h2 id="III-Patterns-Conversion"><a href="#III-Patterns-Conversion" class="headerlink" title="III. Patterns Conversion"></a><a name="patterns-conversion">III. Patterns Conversion</a></h2><img src="/english-grammar/句型转换.png">
<h4 id="A-Affirmative-Sentences-肯定句-→-Negative-Sentences-否定句"><a href="#A-Affirmative-Sentences-肯定句-→-Negative-Sentences-否定句" class="headerlink" title="A. Affirmative Sentences (肯定句) → Negative Sentences (否定句)"></a>A. Affirmative Sentences (肯定句) → Negative Sentences (否定句)</h4><ol>
<li>Be + Not<ul>
<li>I <strong>am</strong> a girl.<ul>
<li>→ I <strong>am not</strong> a girl.</li>
</ul>
</li>
<li>You <strong>are</strong> a student.<ul>
<li>→ You <strong>are not</strong> a student.</li>
<li>→ You <strong>aren’t</strong> a student.</li>
</ul>
</li>
<li>This <strong>is</strong> Tom’s bag.<ul>
<li>→ This <strong>is not</strong> Tom’s bag.</li>
<li>→ This <strong>isn’t</strong> Tom’s bag.</li>
</ul>
</li>
</ul>
</li>
<li>Add Negative Form of Auxiliary (don’t/doesn’t/didn’t) before Transitive Verbs (及物动词)/Intransitive Verbs (不及物动词)（在动词前加助动词的否定形式, don’t/doesn’t/didn’t）<ul>
<li>They really <strong>know</strong> what will happen.<ul>
<li>→ They really <strong>don’t know</strong> what will happen.</li>
</ul>
</li>
<li>Someone <strong>know</strong> what he/she is missing.<ul>
<li>→ Someone <strong>doesn’t know</strong> what he/she is missing.</li>
</ul>
</li>
<li>I <strong>want</strong> to write this.<ul>
<li>→ I <strong>didn’t want</strong> to write this, but the courage to listen to different ideas is vanishing</li>
</ul>
</li>
</ul>
</li>
<li>Auxiliary + Not, can not/should not/will not<ul>
<li>Trump <strong>can keep</strong> his corruption hidden forever.<ul>
<li>→ Trump <strong>cannot keep</strong> his corruption hidden forever.</li>
</ul>
</li>
<li>You <strong>should do</strong> that.<ul>
<li>→ You <strong>should not do</strong> that.</li>
</ul>
</li>
<li>Turkey <strong>will back down</strong> due to US sanctions.<ul>
<li>→ Turkey <strong>will not back down</strong> due to US sanctions.</li>
<li>→ Turkey <strong>won’t back down</strong> due to US sanctions.</li>
</ul>
</li>
</ul>
</li>
<li>some → any<ul>
<li>I got <strong>some</strong> nice presents for Christmas this year.<ul>
<li>→ I didn’t get <strong>any</strong> nice presents for Christmas this year.</li>
</ul>
</li>
<li>I’d like to go <strong>somewhere</strong> hot this summer.<ul>
<li>→ I’m not hungry. I don’t want <strong>anything</strong> to eat.</li>
</ul>
</li>
</ul>
</li>
</ol>
<h4 id="B-Affirmative-Sentences-→-一般疑问句-General-Questions"><a href="#B-Affirmative-Sentences-→-一般疑问句-General-Questions" class="headerlink" title="B. Affirmative Sentences → 一般疑问句 (General Questions)"></a>B. Affirmative Sentences → 一般疑问句 (General Questions)</h4><ol>
<li>Put “Be” at the begin of the sentence (Be动词放在句首)<ul>
<li><strong>I am</strong> in Class 6.<ul>
<li>→ <strong>Are you</strong> in Class 6?</li>
</ul>
</li>
<li><strong>There are</strong> some apples.<ul>
<li>→ <strong>Are there</strong> any apples?</li>
</ul>
</li>
</ul>
</li>
<li>Under the Transitive verbs/Intransitive verbs, put “Do/Does/Did” at the begin of the sentence<ul>
<li><strong>I like</strong> red.<ul>
<li>→ <strong>Do you</strong> like red?</li>
</ul>
</li>
<li><strong>He wants</strong> to play soccer with friends.<ul>
<li>→ <strong>Does he</strong> want to play soccer with friends?</li>
</ul>
</li>
<li><strong>We finished</strong> our homework before nine yesterday.<ul>
<li>→ <strong>Did you</strong> finish your homework before nine yesterday?</li>
</ul>
</li>
</ul>
</li>
<li>Put auxiliary(can/shall/will/…) at the begin of the sentence<ul>
<li><strong>I will</strong> go to hospital tomorrow.<ul>
<li>→ <strong>Will you</strong> go to hospital tomorrow?</li>
</ul>
</li>
<li><strong>He can</strong> climb the tree.<ul>
<li>→ <strong>Can he</strong> climb the tree?</li>
</ul>
</li>
</ul>
</li>
<li>some → any<ul>
<li>We can use <strong>some</strong> in questions when offering/requesting:<ul>
<li>Would you like <strong>some</strong> more tea?</li>
<li>Could I have <strong>some</strong> milk, please?</li>
<li>Do you want <strong>something</strong> to eat?</li>
</ul>
</li>
<li>We use <strong>any</strong> in positive sentences when we mean it doesn’t matter which ..:<ul>
<li>You can come and ask for my help <strong>any</strong> time.</li>
<li>Which book shall I read? - <strong>Any</strong> one. It’s up to you.</li>
<li>You can sit <strong>anywhere</strong> but here. This is my seat!</li>
</ul>
</li>
</ul>
</li>
</ol>
<h4 id="C-Affirmative-Sentences-→-Information-Questions-特殊疑问句"><a href="#C-Affirmative-Sentences-→-Information-Questions-特殊疑问句" class="headerlink" title="C. Affirmative Sentences → Information Questions (特殊疑问句)"></a>C. Affirmative Sentences → Information Questions (特殊疑问句)</h4><ol>
<li>Underline a question part (划出提问部分)</li>
<li>Use a question word to replace this underline, put the question word at the begin of the sentence, and add auxiliary if needed, then exchange the position with the subject (用疑问词替代划线部分, 并移到句首)</li>
<li>And add auxiliary if needed, then exchange the position with the subject (加助动词, 并颠倒主谓)<ul>
<li>Mike is <del>a worker</del>.<ul>
<li>→ <strong>What</strong> <em>is Mike</em>?</li>
</ul>
</li>
<li>He is ~~my brother~.<ul>
<li>→ <strong>Who</strong> <em>is he</em>?</li>
</ul>
</li>
<li>The box is <del>on the desk</del>.<ul>
<li>→ <strong>Where</strong> <em>is the box</em>?</li>
</ul>
</li>
<li>It’s <del>seven twenty</del>.<ul>
<li>→ <strong>What time</strong> <em>is it</em>?</li>
</ul>
</li>
<li>I usually get up <del>at six</del>.<ul>
<li>→ <strong>When</strong> <em>do you</em> usually get up?</li>
</ul>
</li>
<li>I am <del>twelve</del>.<ul>
<li>→ <strong>How old</strong> <em>are you</em>?</li>
</ul>
</li>
<li>My hat is <del>blu</del>.<ul>
<li>→ <strong>What color</strong> <em>is your hat</em>？</li>
</ul>
</li>
<li>I can see <del>five kites</del>.<ul>
<li>→ <strong>How many kites</strong> <em>can you</em> see?</li>
</ul>
</li>
<li>There is <del>some milk</del> in the glass.<ul>
<li>→ <strong>How much milk</strong> <em>is there</em> in the glass?<br>1* This pen is <del>nine yuan</del>.</li>
<li>→ <strong>How much</strong> <em>is this pen</em>?<br>1* That is <del>my book</del>.</li>
<li>→ <strong>Whose book</strong> <em>is that</em>?<br>1* The bag is <del>yours</del>.</li>
<li>→ <strong>Whose</strong> <em>is the bag</em>?</li>
</ul>
</li>
</ul>
</li>
<li>If the question word is subject, then keep the position (如果疑问词作主语(Subject)或主语的定语, 语序保持陈述句的语序)<ul>
<li>He is <del>my brother</del>.<ul>
<li>→ <strong>Who</strong> <span style="color:red"><em>is he</em></span>?</li>
</ul>
</li>
<li><del>He</del> is my brother.<ul>
<li>→ <strong>Who</strong> <span style="color:yellow">is my brother</span>?</li>
</ul>
</li>
</ul>
</li>
</ol>
<h2 id="IV-Verb-Tenses"><a href="#IV-Verb-Tenses" class="headerlink" title="IV. Verb Tenses"></a><a name="verb-tenses">IV. Verb Tenses</a></h2><img src="/english-grammar/verb_time_aspect_1.png">
<h4 id="A-Simplify-以简驭繁的方式"><a href="#A-Simplify-以简驭繁的方式" class="headerlink" title="A. Simplify (以简驭繁的方式)"></a>A. Simplify (以简驭繁的方式)</h4><ul>
<li><p>One sentence only has two aspects, simple and perfect. Add “Be” or “Have/has been” before the original verb. Replace original verb with present participle(Ving) to describe in progress, and replace original verb with past participle(Ven) to describe passive voice.</p>
</li>
<li><p><strong>Time(Past/Present/Future)</strong>和<strong>Aspect</strong>分开处理</p>
</li>
<li>当需要表达进行或被动语态时, 把Be动词当作动词, 句子<strong>只有两种Aspect状态(简单态与完成态)</strong>, 其后的现代分词(Ving)和过去分词(Ven)视为<strong>形容词补语</strong>, Ving表示Continuous, Ven表示Passive Voice</li>
<li>根据Time和Aspect变换Be动词<img src="/english-grammar/verb_time_aspect_2.png">
</li>
</ul>
<h4 id="B-Simple"><a href="#B-Simple" class="headerlink" title="B. Simple"></a>B. Simple</h4><h5 id="a-Past"><a href="#a-Past" class="headerlink" title="a. Past"></a>a. Past</h5><ol>
<li>Ved<ul>
<li>The U.S. <strong>established</strong> diplomatic relations with the P.R.C <span style="color:red">in 1979</span>.</li>
<li>Bush <strong>was</strong> the U.S. President.</li>
</ul>
</li>
<li>Was/Were + Ving<ul>
<li>I <strong>was</strong> <em>visiting</em> clients the whole day <span style="color:red">yesterday</span>.</li>
<li>I <strong>was</strong> <em>watching</em> TV <span style="color:red">when I heard the doorbell</span>.</li>
</ul>
</li>
<li>Was/Were + Ven<ul>
<li>The movable print <strong>was</strong> <em>introduced</em> to England <span style="color:red">in 1485</span>.</li>
</ul>
</li>
<li>Was/Were + being Ven<ul>
<li>The witness <strong>was</strong> <em>being questioned</em> in count <span style="color:red">when he had a heart attack</span>.</li>
<li>The house <strong>was</strong> <em>being painted</em> <span style="color:red">when we arrived</span>.</li>
</ul>
</li>
</ol>
<h5 id="b-Present"><a href="#b-Present" class="headerlink" title="b. Present"></a>b. Present</h5><ol>
<li>V<ul>
<li>All mothers <strong>love</strong> their children.</li>
<li>Huang <strong>pitches</strong> a fast ball. Li <strong>swings</strong>. It <strong>looks</strong> like a hit.<br>The shortstop <strong>fails</strong> to stop it. It<strong>’s</strong> a double.</li>
<li>Trump <strong>is</strong> the U.S. President.</li>
</ul>
</li>
<li>Is/Am/Are + Ving<ul>
<li>7-Eleven <strong>is</strong> <em>selling</em> big cokes at a discount <span style="color:red">this month</span>.</li>
</ul>
</li>
<li>Is/Am/Are + Ven<ul>
<li>The students’ questions <strong>are</strong> always <em>answered</em> by the teacher.</li>
</ul>
</li>
<li>Is/Am/Are + being + Ven<ul>
<li>According to the NASA, the ozone layer <strong>is</strong> <em>being depleted</em>.</li>
<li>How <strong>is</strong> the new teaching method <em>being tried</em> there.</li>
</ul>
</li>
</ol>
<h5 id="c-Future"><a href="#c-Future" class="headerlink" title="c. Future"></a>c. Future</h5><ol>
<li>Will + V<ul>
<li>We <strong>will</strong> <em>rock</em> you.</li>
<li>There <strong>will</strong> _be_ a major election <span style="color:red">in November</span>.</li>
</ul>
</li>
<li>Will be + Ving.<ul>
<li>Don’t call me <span style="color:red">at six tomorrow</span>. I<strong>’ll still be</strong> <em>sleeping</em> then.</li>
<li>Michael <strong>will be</strong> <em>drinking</em> water.</li>
</ul>
</li>
<li>Will be + Ven<ul>
<li>The building <strong>will be</strong> <em>razed</em> <span style="color:red">next month</span>.</li>
</ul>
</li>
<li><del>Will be + being Ven</del>(Unusually)<ul>
<li><del>Water <strong>will be</strong> <em>being drunk</em> by Michael.</del></li>
</ul>
</li>
</ol>
<h5 id="d-Past-Future"><a href="#d-Past-Future" class="headerlink" title="d. Past Future"></a>d. Past Future</h5><ol>
<li><span style="color:red">We told him</span> that we <strong>would</strong> <em>clean</em> the house.</li>
</ol>
<h4 id="C-Perfect"><a href="#C-Perfect" class="headerlink" title="C. Perfect"></a>C. Perfect</h4><h5 id="a-Past-1"><a href="#a-Past-1" class="headerlink" title="a. Past"></a>a. Past</h5><ol>
<li>Had + Ven<ul>
<li>Many soldiers <strong>had</strong> <em>died</em> from pneumonia <span style="color:red">before the discovery of penicillin</span>.</li>
</ul>
</li>
<li>Had been + Ving<ul>
<li>I <strong>had been</strong> <em>smoking</em> three packs of cigarettes a day <span style="color:red">before I decided to quit</span>.</li>
</ul>
</li>
<li>Had been + Ven<ul>
<li>Japan <strong>had not been</strong> <em>defeated</em> yet <span style="color:red">by the time Germany surrendered unconditionally</span>.</li>
</ul>
</li>
</ol>
<h5 id="b-Present-1"><a href="#b-Present-1" class="headerlink" title="b. Present"></a>b. Present</h5><ol>
<li>Has/Have + Ven<ul>
<li>I’m sure I <strong>have</strong> <em>seen</em> this face somewhere.</li>
</ul>
</li>
<li>Has/Have been + Ving<ul>
<li>We <strong>have been</strong> <em>working</em> overtime <span style="color:red">for a week</span> to fill your order.</li>
</ul>
</li>
<li>Has/Have been + Ven<ul>
<li>The house <strong>has been</strong> <em>redecorated</em> twice <span style="color:red">since they moved in</span>.</li>
</ul>
</li>
</ol>
<h5 id="c-Future-1"><a href="#c-Future-1" class="headerlink" title="c. Future"></a>c. Future</h5><ol>
<li>Will have + Ven<ul>
<li>Next April, I <strong>will have</strong> <em>worked</em> here <span style="color:red">for 20 years</span>.</li>
</ul>
</li>
<li>Will have been + Ving<ul>
<li><span style="color:red">In two more minutes</span>, she <strong>will have been</strong> <em>talking</em> on the phone <span style="color:red">for three hours</span>.</li>
</ul>
</li>
<li>Will have been + Ven<ul>
<li>Come back <span style="color:red">at 5:00</span>. Your car <strong>will have been</strong> <em>fixed</em> <span style="color:red">by then</span>.</li>
</ul>
</li>
</ol>
<h2 id="V-Verbals"><a href="#V-Verbals" class="headerlink" title="V. Verbals"></a><a name="verbals">V. Verbals</a></h2><table>
<thead>
<tr>
<th>Type</th>
<th>Pattern</th>
<th>Part of Speech</th>
<th>Role in Sentence</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>Present Participle (现在分词)</td>
<td>Ving</td>
<td>Adjectives (形容词)</td>
<td>Complements</td>
<td></td>
</tr>
<tr>
<td>Past Participle (过去分词)</td>
<td>Ven</td>
<td>Adjectives (形容词)</td>
<td>Complements</td>
<td></td>
</tr>
<tr>
<td>Gerunds (动名词)</td>
<td>Ving</td>
<td>Nouns (名词)</td>
<td>Subjects/Objects/Complements</td>
<td></td>
</tr>
<tr>
<td>Infinitive (不定式短语)</td>
<td>to do</td>
<td>Nouns</td>
<td>Subjects/Objects/Complements</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>Adjectives</td>
<td>Subjects/Objects/Complements</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>Adverbials</td>
<td>修饰动词或形容词</td>
</tr>
</tbody>
</table>
<h4 id="A-Infinitive"><a href="#A-Infinitive" class="headerlink" title="A. Infinitive"></a>A. Infinitive</h4><h5 id="a-From-Auxiliaries-to-Infinitive-从助动词演变到不定式短语"><a href="#a-From-Auxiliaries-to-Infinitive-从助动词演变到不定式短语" class="headerlink" title="a. From Auxiliaries to Infinitive (从助动词演变到不定式短语)"></a>a. From Auxiliaries to Infinitive (从助动词演变到不定式短语)</h5><ol>
<li>I am glad because I <strong>can</strong> know you. <span style="color:red">S+V+C(Clause)</span><ul>
<li>→ I am glad because I <strong>am able to</strong> know you. <span style="color:red">Auxiliaries → be able to</span><ul>
<li>→ I am glad <del>because I am able</del> to know you. <span style="color:red">Conjunction, Subject and Be are omitted</span></li>
</ul>
</li>
</ul>
</li>
</ol>
<table>
<thead>
<tr>
<th>Auxiliaries</th>
<th>Infinitive</th>
</tr>
</thead>
<tbody>
<tr>
<td>must</td>
<td>have to</td>
</tr>
<tr>
<td>should</td>
<td>ought to</td>
</tr>
<tr>
<td>will/would</td>
<td>be going to</td>
</tr>
<tr>
<td>can/could</td>
<td>be able to</td>
</tr>
<tr>
<td>may/might</td>
<td>be likely to</td>
</tr>
</tbody>
</table>
<h5 id="b-Have-an-uncertain-tone-都有不确定的语气"><a href="#b-Have-an-uncertain-tone-都有不确定的语气" class="headerlink" title="b. Have an uncertain tone (都有不确定的语气)"></a>b. Have an uncertain tone (都有不确定的语气)</h5><ol>
<li>He is right. <span style="color:red">他是对的</span></li>
<li>He <strong>may be</strong> right. <span style="color:red">他可能式对的</span></li>
<li>He seems <strong>to be</strong> right. <span style="color:red">他好像是对的</span></li>
</ol>
<h5 id="c-Use-the-Perfect-to-Express-the-Past-都是用完成式来表达相对过去的时间"><a href="#c-Use-the-Perfect-to-Express-the-Past-都是用完成式来表达相对过去的时间" class="headerlink" title="c. Use the Perfect to Express the Past (都是用完成式来表达相对过去的时间)"></a>c. Use the Perfect to Express the Past (都是用完成式来表达相对过去的时间)</h5><ol>
<li>In Progress (现在进行中)<ul>
<li>It <strong>must be</strong> <em>raining</em> now. <span style="color:red">现在一定下雨了</span></li>
</ul>
</li>
<li>Future Speculation (未来的推测)<ul>
<li>It <strong>may</strong> <em>rain</em> any minutes.</li>
<li>It <strong>might</strong> even <em>snow</em>。</li>
</ul>
</li>
<li>Speculation about the past (对过去的推测)<ul>
<li>It <strong>must</strong> <em>have rained</em> last night. <span style="color:red">昨晚一定下过雨了</span></li>
<li>It <strong>seems to</strong> <em>have rained</em> last night. <span style="color:red">昨晚好像下过雨</span></li>
</ul>
</li>
</ol>
<h5 id="c-Infinitive-VS-Gerund"><a href="#c-Infinitive-VS-Gerund" class="headerlink" title="c. Infinitive VS Gerund"></a>c. Infinitive VS Gerund</h5><ol>
<li>plan<ul>
<li>They plan that they <strong>will</strong> marry next month.<ul>
<li>→ They plan <del>that they <strong>are</strong></del> to marry next month.<ul>
<li>→ They <strong>plan to marry</strong> next month.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>avoid<ul>
<li>I <strong>avoid making</strong> the same mistake twice.</li>
</ul>
</li>
<li>hate<ul>
<li>I hate I <strong>must</strong> say, but I think you’re mistaken.<ul>
<li>→ I hate <del>I <strong>have</strong></del> to say, but I think you’re mistaken.<ul>
<li>→ I <strong>hate to</strong> say this, but I think you’re mistaken.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>like/dislike<ul>
<li>I <strong>like to be</strong> the first.</li>
<li>I <strong>don’t like to wait</strong> too long.</li>
<li>I <strong>dislike standing</strong> in long lines. <span style="color:red">dislike没有”必须”(have to)的暗示</span></li>
</ul>
</li>
<li>try<ul>
<li>I always <strong>try to be</strong> on time.</li>
<li>Why don’t you <strong>try being</strong> late for a change? <span style="color:red">你何不故意迟到一次呢？</span></li>
</ul>
</li>
<li>remember<ul>
<li>Please <strong>remember to give</strong> me a wake-up call at 6:00 tomorrow.</li>
<li>I <strong>remember calling</strong> her at 6:00 last night.</li>
</ul>
</li>
<li>shop<ul>
<li>The speaker <strong>stopped talking</strong> at the second bell.</li>
<li>The speaker <strong>stopped a second to drink</strong> some water.</li>
</ul>
</li>
<li>Verbs Followed by Gerunds <a href="https://www.englishpage.com/gerunds/index.htm" target="_blank" rel="noopener">www.englishpage.com</a><ul>
<li>9 = verb followed by a gerund OR a noun + an infinitive</li>
<li>13 = verb followed by a gerund OR an infinitive with a difference in meaning</li>
<li>14 = verb followed by a gerund OR an infinitive with little difference in meaning</li>
</ul>
</li>
</ol>
<table>
<thead>
<tr>
<th>verb</th>
<th>example</th>
</tr>
</thead>
<tbody>
<tr>
<td>admit</td>
<td>He admitted cheating on the test.</td>
</tr>
<tr>
<td>advise [9]</td>
<td>The doctor generally advised drinking low-fat milk.</td>
</tr>
<tr>
<td>allow [9]</td>
<td>Ireland doesn’t allow smoking in bars.</td>
</tr>
<tr>
<td>anticipate</td>
<td>I anticipated arriving late.</td>
</tr>
<tr>
<td>appreciate</td>
<td>I appreciated her helping me.</td>
</tr>
<tr>
<td>avoid</td>
<td>He avoided talking to her.</td>
</tr>
<tr>
<td>begin [14]</td>
<td>I began learning Chinese.</td>
</tr>
<tr>
<td>can’t bear [14]</td>
<td>He can’t bear having so much responsibility.</td>
</tr>
<tr>
<td>can’t help</td>
<td>He can’t help talking so loudly.</td>
</tr>
<tr>
<td>can’t see</td>
<td>I can’t see paying so much money for a car.</td>
</tr>
<tr>
<td>can’t stand [14]</td>
<td>He can’t stand her smoking in the office.</td>
</tr>
<tr>
<td>cease [14]</td>
<td>The government ceased providing free healthcare.</td>
</tr>
<tr>
<td>complete</td>
<td>He completed renovating the house.</td>
</tr>
<tr>
<td>consider</td>
<td>She considered moving to New York.</td>
</tr>
<tr>
<td>continue [14]</td>
<td>He continued talking.</td>
</tr>
<tr>
<td>defend</td>
<td>The lawyer defended her making such statements.</td>
</tr>
<tr>
<td>delay</td>
<td>He delayed doing his taxes.</td>
</tr>
<tr>
<td>deny</td>
<td>He denied committing the crime.</td>
</tr>
<tr>
<td>despise</td>
<td>She despises waking up early.</td>
</tr>
<tr>
<td>discuss</td>
<td>We discussed working at the company.</td>
</tr>
<tr>
<td>dislike</td>
<td>She dislikes working after 5 PM.</td>
</tr>
<tr>
<td>don’t mind</td>
<td>I don’t mind helping you.</td>
</tr>
<tr>
<td>dread [13]</td>
<td>She dreads getting up at 5 AM.</td>
</tr>
<tr>
<td>encourage [9]</td>
<td>He encourages eating healthy foods.</td>
</tr>
<tr>
<td>enjoy</td>
<td>We enjoy hiking.</td>
</tr>
<tr>
<td>finish [13]</td>
<td>He finished doing his homework.</td>
</tr>
<tr>
<td>forget [13]</td>
<td>I forgot giving you my book.</td>
</tr>
<tr>
<td>hate [14]</td>
<td>I hate cleaning the bathroom.</td>
</tr>
<tr>
<td>imagine</td>
<td>He imagines working there one day.</td>
</tr>
<tr>
<td>involve</td>
<td>The job involves traveling to Japan once a month.</td>
</tr>
<tr>
<td>keep</td>
<td>She kept interrupting me.</td>
</tr>
<tr>
<td>like [14]</td>
<td>She likes listening to music.</td>
</tr>
<tr>
<td>love [14]</td>
<td>I love swimming.</td>
</tr>
<tr>
<td>mention</td>
<td>He mentioned going to that college.</td>
</tr>
<tr>
<td>mind</td>
<td>Do you mind waiting here for a few minutes.</td>
</tr>
<tr>
<td>miss</td>
<td>She misses living near the beach.</td>
</tr>
<tr>
<td>need [13]</td>
<td>The aquarium needs cleaning.</td>
</tr>
<tr>
<td>neglect [14]</td>
<td>Sometimes she neglects doing her homework.</td>
</tr>
<tr>
<td>permit [9]</td>
<td>California does not permit smoking in restaurants.</td>
</tr>
<tr>
<td>postpone</td>
<td>He postponed returning to Paris.</td>
</tr>
<tr>
<td>practice</td>
<td>She practiced singing the song.</td>
</tr>
<tr>
<td>prefer [14]</td>
<td>He prefers sitting at the back of the movie theater.</td>
</tr>
<tr>
<td>propose [14]</td>
<td>I proposed having lunch at the beach.</td>
</tr>
<tr>
<td>quit [13]</td>
<td>She quit worrying about the problem.</td>
</tr>
<tr>
<td>recall</td>
<td>Tom recalled using his credit card at the store.</td>
</tr>
<tr>
<td>recollect</td>
<td>She recollected living in Kenya.</td>
</tr>
<tr>
<td>recommend</td>
<td>Tony recommended taking the train.</td>
</tr>
<tr>
<td>regret [13]</td>
<td>She regretted saying that.</td>
</tr>
<tr>
<td>remember [13]</td>
<td>I remember telling her the address yesterday.</td>
</tr>
<tr>
<td>report</td>
<td>He reported her stealing the money.</td>
</tr>
<tr>
<td>require [9]</td>
<td>The certificate requires completing two courses.</td>
</tr>
<tr>
<td>resent</td>
<td>Nick resented Debbie’s being there.</td>
</tr>
<tr>
<td>resist</td>
<td>He resisted asking for help.</td>
</tr>
<tr>
<td>risk</td>
<td>He risked being caught.</td>
</tr>
<tr>
<td>start [14]</td>
<td>He started studying harder.</td>
</tr>
<tr>
<td>stop [13]</td>
<td>She stopped working at 5 o’clock.</td>
</tr>
<tr>
<td>suggest</td>
<td>They suggested staying at the hotel.</td>
</tr>
<tr>
<td>tolerate</td>
<td>I tolerated her talking.</td>
</tr>
<tr>
<td>try [13]</td>
<td>Sam tried opening the lock with a paperclip.</td>
</tr>
<tr>
<td>understand</td>
<td>I understand his quitting.</td>
</tr>
<tr>
<td>urge [9]</td>
<td>They urge recycling bottles and paper.</td>
</tr>
</tbody>
</table>
<ol>
<li>Verbs Followed by Infinitives <a href="https://www.englishpage.com/gerunds/index.htm" target="_blank" rel="noopener">www.englishpage.com</a><ul>
<li>8 = verb followed by an infinitive OR an optional noun + an infinitive</li>
<li>13 = verb followed by a gerund OR an infinitive with a difference in meaning</li>
<li>14 = verb followed by a gerund OR an infinitive with little difference in meaning</li>
</ul>
</li>
</ol>
<table>
<thead>
<tr>
<th>verb</th>
<th>example</th>
</tr>
</thead>
<tbody>
<tr>
<td>agree</td>
<td>Tom agreed to help me.</td>
</tr>
<tr>
<td>appear</td>
<td>His health appeared to be better.</td>
</tr>
<tr>
<td>arrange</td>
<td>Naomi arranged to stay with her cousin in Miami.</td>
</tr>
<tr>
<td>ask [8]</td>
<td>She asked to leave.</td>
</tr>
<tr>
<td>begin [13]</td>
<td>He began to talk.</td>
</tr>
<tr>
<td>can’t bear [14]</td>
<td>He can’t bear to be alone.</td>
</tr>
<tr>
<td>can’t stand [14]</td>
<td>Nancy can’t stand to work the late shift.</td>
</tr>
<tr>
<td>care</td>
<td>He doesn’t care to participate in the activity.</td>
</tr>
<tr>
<td>cease [14]</td>
<td>The government ceased to provide free healthcare.</td>
</tr>
<tr>
<td>choose [8]</td>
<td>I chose to help.</td>
</tr>
<tr>
<td>claim</td>
<td>She claimed to be a princess.</td>
</tr>
<tr>
<td>continue [14]</td>
<td>She continued to talk.</td>
</tr>
<tr>
<td>decide</td>
<td>We decided to go to Hawaii.</td>
</tr>
<tr>
<td>demand</td>
<td>He demanded to speak to Mr. Harris.</td>
</tr>
<tr>
<td>deserve</td>
<td>He deserves to go to jail.</td>
</tr>
<tr>
<td>dread [13]</td>
<td>I dread to think what might happen.</td>
</tr>
<tr>
<td>expect [8]</td>
<td>They expect to arrive early.</td>
</tr>
<tr>
<td>fail</td>
<td>He failed to get enough money to pay for the new project.</td>
</tr>
<tr>
<td>forget [13]</td>
<td>I forgot to lock the door when I left.</td>
</tr>
<tr>
<td>get (be allowed to)</td>
<td>Debbie gets to go to the concert next week! Why can’t I?</td>
</tr>
<tr>
<td>happen</td>
<td>She happened to be at the bank when it was robbed.</td>
</tr>
<tr>
<td>hate [14]</td>
<td>He hates to clean dishes.</td>
</tr>
<tr>
<td>hesitate</td>
<td>She hesitated to tell me the problem.</td>
</tr>
<tr>
<td>hope</td>
<td>I hope to begin college this year.</td>
</tr>
<tr>
<td>intend</td>
<td>We intend to visit you next spring.</td>
</tr>
<tr>
<td>learn</td>
<td>I learned to speak Japanese when I was a kid.</td>
</tr>
<tr>
<td>like [14]</td>
<td>Samantha likes to read.</td>
</tr>
<tr>
<td>love [14]</td>
<td>We love to scuba dive.</td>
</tr>
<tr>
<td>manage</td>
<td>He managed to open the door without the key.</td>
</tr>
<tr>
<td>need [8,13]</td>
<td>I need to study.</td>
</tr>
<tr>
<td>neglect [14]</td>
<td>She neglected to tell me the date of the meeting.</td>
</tr>
<tr>
<td>offer</td>
<td>Frank offered to drive us to the supermarket.</td>
</tr>
<tr>
<td>plan</td>
<td>We plan to go to Europe this summer.</td>
</tr>
<tr>
<td>prefer [14]</td>
<td>He prefers to eat at 7 PM.</td>
</tr>
<tr>
<td>prepare [8]</td>
<td>They prepared to take the test.</td>
</tr>
<tr>
<td>pretend</td>
<td>The child pretended to be a monster.</td>
</tr>
<tr>
<td>promise [8]</td>
<td>She promised to stop smoking.</td>
</tr>
<tr>
<td>propose [14]</td>
<td>Drew proposed to pay for the trip.</td>
</tr>
<tr>
<td>refuse</td>
<td>The guard refused to let them enter the building.</td>
</tr>
<tr>
<td>regret [13]</td>
<td>I regret to inform you that your application was rejected.</td>
</tr>
<tr>
<td>remember [13]</td>
<td>Did you remember to lock the door when you left?</td>
</tr>
<tr>
<td>seem</td>
<td>Nancy seemed to be disappointed.</td>
</tr>
<tr>
<td>start [13]</td>
<td>Marge started to talk really fast.</td>
</tr>
<tr>
<td>swear</td>
<td>She swore to tell the truth.</td>
</tr>
<tr>
<td>tend</td>
<td>He tends to be a little shy.</td>
</tr>
<tr>
<td>threaten [8]</td>
<td>He threatened to leave forever.</td>
</tr>
<tr>
<td>try [13]</td>
<td>Mary tried to lift the table, but it was too heavy.</td>
</tr>
<tr>
<td>vow</td>
<td>He vowed to get revenge.</td>
</tr>
<tr>
<td>wait</td>
<td>She waited to buy a movie ticket.</td>
</tr>
<tr>
<td>want [8]</td>
<td>I want to study Spanish.</td>
</tr>
<tr>
<td>wish [8]</td>
<td>I wish to stay.</td>
</tr>
<tr>
<td>would like [8]</td>
<td>(meaning “wish” or “want”)    We would like to start now.</td>
</tr>
<tr>
<td>yearn</td>
<td>Melanie yearns to travel somewhere exotic.</td>
</tr>
</tbody>
</table>
<h4 id="B-Causative-Verbs-and-Original-Form-使役动词和动词原型"><a href="#B-Causative-Verbs-and-Original-Form-使役动词和动词原型" class="headerlink" title="B. Causative Verbs and Original Form(使役动词和动词原型)"></a>B. Causative Verbs and Original Form(使役动词和动词原型)</h4><ol>
<li>The teacher <strong>made</strong> the little girl <strong>stay</strong> behind.<br> <span style="color:red"><ul>
<li>Causative verbs like “let/have/make/…” are followed by original forms of verbs, because their results are not uncertain, and can not be followed by infinitives</li>
<li>let/have/make等使役动词, 后面是接原型动词, 是因为它的结果不具有不确定性, 因而不能用不定式<br></li></ul></span></li>


<li>The teacher <strong>asked</strong> the little girl <strong>to stay</strong> behind.</li>
<li>John <strong>had</strong> his car <strong>painted</strong> over.<ul>
<li><span style="color:red">Causative Verbs can also be followed by Ven (并不是使役动词后面只能用原型)</span></li>
</ul>
</li>
</ol>
<h4 id="C-Verbs-of-Perception-and-Original-Form-感官动词和动词原型"><a href="#C-Verbs-of-Perception-and-Original-Form-感官动词和动词原型" class="headerlink" title="C. Verbs of Perception and Original Form (感官动词和动词原型)"></a>C. Verbs of Perception and Original Form (感官动词和动词原型)</h4><ol>
<li>I <strong>heard</strong> her <strong>playing</strong>the violin.<br> <span style="color:red"><ul>
<li>Verbs of Perception can only be used in what really happened, they come with present participle</li>
<li>感官动词see/hear/watch, 只能配合确实发生过的事情, 可以和现在分词一起使用.<br></li></ul></span></li>


<li>I <strong>heard </strong>her <strong>cry</strong> out in pain.<ul>
<li><span style="color:red">大叫一声, 叫声并不能持续, 所以不能用现在分词. 既不能用不定式, 也没有被动的语态, 所以只好用动词原型了</span></li>
</ul>
</li>
</ol>
<h4 id="D-Gerunds"><a href="#D-Gerunds" class="headerlink" title="D. Gerunds"></a>D. Gerunds</h4><h2 id="VI-Moods"><a href="#VI-Moods" class="headerlink" title="VI. Moods"></a><a name="moods">VI. Moods</a></h2><h4 id="A-Indicative-叙述事实的语气"><a href="#A-Indicative-叙述事实的语气" class="headerlink" title="A. Indicative (叙述事实的语气)"></a>A. Indicative (叙述事实的语气)</h4><h5 id="a-Now-or-in-the-past-true-and-false-can-be-determined-so-use-the-tone-of-narrative-facts-The-future-has-not-yet-happened-Strictly-speaking-it-is-still-not-certain-whether-it-is-true-or-false-This-is-why-adding-the-auxiliary-verb-before-the-verb-in-the-future-mode-Because-the-auxiliary-verbs-are-uncertain-现在和过去的事情-真假已经可以确定-所以用叙述事实的语气-未来的事情还没有发生-严格说来还不能确定真假-这就是为啥未来式要在动词前加上助动词will-因为助动词都带有不确定性"><a href="#a-Now-or-in-the-past-true-and-false-can-be-determined-so-use-the-tone-of-narrative-facts-The-future-has-not-yet-happened-Strictly-speaking-it-is-still-not-certain-whether-it-is-true-or-false-This-is-why-adding-the-auxiliary-verb-before-the-verb-in-the-future-mode-Because-the-auxiliary-verbs-are-uncertain-现在和过去的事情-真假已经可以确定-所以用叙述事实的语气-未来的事情还没有发生-严格说来还不能确定真假-这就是为啥未来式要在动词前加上助动词will-因为助动词都带有不确定性" class="headerlink" title="a. Now or in the past, true and false can be determined, so use the tone of narrative facts. The future has not yet happened. Strictly speaking, it is still not certain whether it is true or false. This is why adding the auxiliary verb before the verb in the future mode. Because the auxiliary verbs are uncertain. (现在和过去的事情, 真假已经可以确定, 所以用叙述事实的语气. 未来的事情还没有发生, 严格说来还不能确定真假, 这就是为啥未来式要在动词前加上助动词will, 因为助动词都带有不确定性.)"></a>a. Now or in the past, true and false can be determined, so use the tone of narrative facts. The future has not yet happened. Strictly speaking, it is still not certain whether it is true or false. This is why adding the auxiliary verb before the verb in the future mode. Because the auxiliary verbs are uncertain. (现在和过去的事情, 真假已经可以确定, 所以用叙述事实的语气. 未来的事情还没有发生, 严格说来还不能确定真假, 这就是为啥未来式要在动词前加上助动词will, 因为助动词都带有不确定性.)</h5><ol>
<li>He went to the U.S. last year.</li>
<li>I will go to the U.S. next year to study for an MBA degree.</li>
</ol>
<h5 id="b-Can-be-calculated-by-formula-can-be-described-as-facts-可以用公式计算出来-可以当作事实来叙述"><a href="#b-Can-be-calculated-by-formula-can-be-described-as-facts-可以用公式计算出来-可以当作事实来叙述" class="headerlink" title="b. Can be calculated by formula, can be described as facts (可以用公式计算出来, 可以当作事实来叙述)"></a>b. Can be calculated by formula, can be described as facts (可以用公式计算出来, 可以当作事实来叙述)</h5><ol>
<li>The weatherman says sunrise tomorrow is at 5:32.</li>
<li>The movie starts in 5 minutes. 同上</li>
</ol>
<h5 id="c-The-clause-describes-two-things-in-the-future-It-is-necessary-to-assume-that-one-of-them-is-a-fact-and-then-we-can-infer-another-one-So-the-clause-uses-the-present-form-主从句同时叙述两件未来的事情-需要先假定其中一件是事实-才能推论另外一件-所以从句用现在式"><a href="#c-The-clause-describes-two-things-in-the-future-It-is-necessary-to-assume-that-one-of-them-is-a-fact-and-then-we-can-infer-another-one-So-the-clause-uses-the-present-form-主从句同时叙述两件未来的事情-需要先假定其中一件是事实-才能推论另外一件-所以从句用现在式" class="headerlink" title="c. The clause describes two things in the future. It is necessary to assume that one of them is a fact, and then we can infer another one. So the clause uses the present form. (主从句同时叙述两件未来的事情, 需要先假定其中一件是事实, 才能推论另外一件. 所以从句用现在式)"></a>c. The clause describes two things in the future. It is necessary to assume that one of them is a fact, and then we can infer another one. So the clause uses the present form. (主从句同时叙述两件未来的事情, 需要先假定其中一件是事实, 才能推论另外一件. 所以从句用现在式)</h5><ol>
<li>I’ll be ready when he comes.</li>
<li>If you are late again, you will be fired.</li>
</ol>
<h4 id="B-Conditional-条件语气"><a href="#B-Conditional-条件语气" class="headerlink" title="B. Conditional (条件语气)"></a>B. Conditional (条件语气)</h4><h5 id="a-Adding-an-auxiliary-verb-to-a-sentence-producing-an-indeterminate-tone-called-conditional-tone-句子中加上助动词-产生不确定的语气-称为条件语气"><a href="#a-Adding-an-auxiliary-verb-to-a-sentence-producing-an-indeterminate-tone-called-conditional-tone-句子中加上助动词-产生不确定的语气-称为条件语气" class="headerlink" title="a. Adding an auxiliary verb to a sentence, producing an indeterminate tone, called conditional tone (句子中加上助动词, 产生不确定的语气, 称为条件语气)"></a>a. Adding an auxiliary verb to a sentence, producing an indeterminate tone, called conditional tone (句子中加上助动词, 产生不确定的语气, 称为条件语气)</h5><ol>
<li>You <strong>are</strong> right.<ul>
<li>→ You <strong>may be</strong> right.</li>
</ul>
</li>
<li>The doctor thinks it <strong>can be</strong> AIDS.<ul>
<li>→ It <strong>could be</strong> anything - AIDS or a common cold.</li>
</ul>
</li>
</ol>
<h5 id="b-Use-the-perfect-expression-to-infer-which-happened-in-the-past-用完成式表达对过去的猜测"><a href="#b-Use-the-perfect-expression-to-infer-which-happened-in-the-past-用完成式表达对过去的猜测" class="headerlink" title="b. Use the perfect expression to infer which happened in the past (用完成式表达对过去的猜测)"></a>b. Use the perfect expression to infer which happened in the past (用完成式表达对过去的猜测)</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">must → should</span><br><span class="line">will → would</span><br><span class="line">can → could</span><br><span class="line">may → might</span><br><span class="line">It does not represent a change in time, but rather a more uncertain tone. It need a special way to express the past time. (并不代表时间上的变化, 而是表示更不确定的语气, 要用一种特别的方式来表达过去时间)</span><br></pre></td></tr></table></figure>
<ol>
<li>It <strong>may rain</strong> any minute now.<ul>
<li>→ It <strong>may have rained</strong> a little last night.</li>
</ul>
</li>
</ol>
<h4 id="C-Subjunctive-假设语气"><a href="#C-Subjunctive-假设语气" class="headerlink" title="C. Subjunctive (假设语气)"></a>C. Subjunctive (假设语气)</h4><table>
<thead>
<tr>
<th>Time</th>
<th>从句</th>
<th>主语</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>要把假设条件当真, 所以不能用表示不确定性的助动词</td>
<td>在一个假定条件下”就会/就可能”有啥结果, 所以用过去拼法的助动词</td>
</tr>
<tr>
<td><span style="color:blue">现在时间</span></td>
<td><span style="color:blue">现在式 → 过去式</span></td>
<td><span style="color:blue">过去拼法的助动词 + V(动词原型)</span></td>
</tr>
<tr>
<td></td>
<td>If I were you</td>
<td>I wouldn’t do it</td>
</tr>
<tr>
<td></td>
<td>If I were to take the bribe</td>
<td>I could never look at other people in the eye again</td>
</tr>
<tr>
<td><span style="color:blue">过去时间</span></td>
<td><span style="color:blue">过去式 → 过去完成式</span></td>
<td><span style="color:blue">过去拼法的助动词 + have + Ven(完成)</span></td>
</tr>
<tr>
<td></td>
<td>If I had known earlier</td>
<td>I might have done something</td>
</tr>
<tr>
<td></td>
<td>If the bear had been more than just curious</td>
<td>Things might have turned out a little differently</td>
</tr>
<tr>
<td>未来时间</td>
<td>过去拼法的助动词 + V(动词原型)</td>
<td>过去拼法的助动词 + V(动词原型)</td>
</tr>
<tr>
<td>未来时间接近条件语气, 表示不确定的语气</td>
<td>If an asteroid should hit the earth</td>
<td>man could die out</td>
</tr>
<tr>
<td></td>
<td>If I should take the money</td>
<td>could you guarantee secrecy</td>
</tr>
<tr>
<td><span style="color:blue">过去 + 现在</span></td>
<td>If I <strong>had studied</strong> harder in school</td>
<td>I <strong>could qualify</strong> for the job <strong>now</strong></td>
</tr>
<tr>
<td><span style="color:blue">混合真假</span></td>
<td>If I had have any money with me(<strong>false</strong>) → only that I didn’t have any money with me(<strong>true</strong>)</td>
<td>I could have contributed to the fund drive then</td>
</tr>
<tr>
<td><span style="color:Fuchsia">句型变换</span></td>
<td>It’s time <strong>you kid were in bed</strong></td>
<td></td>
</tr>
<tr>
<td></td>
<td><strong>If only I had more time!</strong></td>
<td></td>
</tr>
<tr>
<td></td>
<td><strong>I wish I had more time!</strong></td>
</tr>
</tbody>
</table>
<h4 id="D-Imperative-祈使语气"><a href="#D-Imperative-祈使语气" class="headerlink" title="D. Imperative (祈使语气)"></a>D. Imperative (祈使语气)</h4><h2 id="VII-Reduced-Clauses"><a href="#VII-Reduced-Clauses" class="headerlink" title="VII. Reduced Clauses"></a><a name="reduced-clauses">VII. Reduced Clauses</a></h2><h4 id="A-通用规则"><a href="#A-通用规则" class="headerlink" title="A. 通用规则"></a>A. 通用规则</h4><h5 id="a-省略从句中的主语和Be动词-只留补语"><a href="#a-省略从句中的主语和Be动词-只留补语" class="headerlink" title="a. 省略从句中的主语和Be动词, 只留补语"></a>a. 省略从句中的主语和Be动词, 只留补语</h5><ol>
<li>Whether <del>it is</del> insured or not(副词从句), your house, <del>which is</del> a wooden building(形容词从句), needs a fire alarm.<ul>
<li>→ Whether insured or not, your house, a wooden building, needs a fire alarm.</li>
</ul>
</li>
<li>It is common courtesy <del>that one should( → is</del> to<del>)</del> wear black(名词从句) while <del>one attends( → is</del> attending<del>)</del> a funeral(副词从句).<ul>
<li>→ It is common courtesy to wear black while attending a funeral.</li>
</ul>
</li>
</ol>
<h5 id="b-没有Be动词如何处理"><a href="#b-没有Be动词如何处理" class="headerlink" title="b. 没有Be动词如何处理"></a>b. 没有Be动词如何处理</h5><ol>
<li>有助动词 → 不定式<ul>
<li>He studied hard so that he could get a scholarship.<ul>
<li>→ He studied hard <del>so that he was (able)</del> to get a scholarship.</li>
<li>→ He studied hard to get scholarship.</li>
</ul>
</li>
<li>省略后意思如果不清楚可以如此补充<ul>
<li>He studied hard <strong>so as to</strong> get scholarship.</li>
<li>He studied hard <strong>in order to</strong> get a scholarship.</li>
</ul>
</li>
</ul>
</li>
<li>没有助动词 → Ving<ul>
<li>John remembers that he saw the lady before.<ul>
<li>→ John remembers seeing the lady before.</li>
</ul>
</li>
</ul>
</li>
</ol>
<h4 id="B-形容词从句-关系从句-的简化"><a href="#B-形容词从句-关系从句-的简化" class="headerlink" title="B. 形容词从句(关系从句)的简化"></a>B. 形容词从句(关系从句)的简化</h4><h5 id="a-补语为Ven"><a href="#a-补语为Ven" class="headerlink" title="a. 补语为Ven"></a>a. 补语为Ven</h5><ol>
<li>Beer <strong>which is chilled to 6 ℃</strong> is most delicious.<ul>
<li>→ Beer <strong>chilled to 6 ℃</strong> is most delicious.</li>
</ul>
</li>
<li>Your brother John, <strong>who was wounded in war</strong>, will soon be sent home.<ul>
<li>→ Your brother, <strong>wounded in war</strong>, will soon be sent home.</li>
</ul>
</li>
</ol>
<h5 id="b-补语为Ving"><a href="#b-补语为Ving" class="headerlink" title="b. 补语为Ving"></a>b. 补语为Ving</h5><ol>
<li>The ship <strong>which is coming to shore</strong> is from Gaoxiong.<ul>
<li>→ The ship <strong>coming to shore</strong> is from Gaoxiong.</li>
</ul>
</li>
<li>My old car, <strong>which break down every other week</strong>, won’t last much longer.<ul>
<li>→ My old car, <strong>breaking down every other week</strong>, won’t last much longer.<br>👉 <a href="##### b. 没有Be动词如何处理">通用规则b</a></li>
</ul>
</li>
</ol>
<h5 id="c-补语为不定式"><a href="#c-补语为不定式" class="headerlink" title="c. 补语为不定式"></a>c. 补语为不定式</h5><ol>
<li>John is the one <strong>who should go this time</strong>.<ul>
<li>→ John is the one <strong>to go this time</strong>.</li>
</ul>
</li>
<li>关于不定式主动和被动的问题, 下面两句都是👌的<ul>
<li>John is not a man <strong><del>whom</del> one can trust</strong><ul>
<li>→ John is not a man <strong>one can trust</strong></li>
<li>→ John is not a man <strong>to trust</strong>.</li>
</ul>
</li>
<li>John is not a man <strong>who can be trusted</strong><ul>
<li>→ John is not a man <strong>to be trusted</strong>.</li>
</ul>
</li>
</ul>
</li>
</ol>
<h5 id="d-补语为形容词或名词"><a href="#d-补语为形容词或名词" class="headerlink" title="d. 补语为形容词或名词"></a>d. 补语为形容词或名词</h5><ol>
<li>Hilary Clinton, <strong>who is pretty and intelligent</strong>, is a popular First Lady.<ul>
<li>→ Hilary Clinton, <strong>pretty and intelligent</strong>, is a popular First Lady.</li>
</ul>
</li>
<li>Bill Clinton, <strong>who is President of the U.S.</strong>, is a Baby Boomer.<ul>
<li>→ Bill Clinton, <strong> President of the U.S.</strong>, is a Baby Boomer.</li>
</ul>
</li>
</ol>
<h4 id="C-名词从句的简化"><a href="#C-名词从句的简化" class="headerlink" title="C. 名词从句的简化"></a>C. 名词从句的简化</h4><h5 id="a-简化后剩下的补语式Ving形态时"><a href="#a-简化后剩下的补语式Ving形态时" class="headerlink" title="a. 简化后剩下的补语式Ving形态时"></a>a. 简化后剩下的补语式Ving形态时</h5><ol>
<li><strong>That I drink good wine with friends</strong> is my greatest enjoyment.<ul>
<li>→ <strong>Drinking good wine with friends</strong> is my greatest enjoyment.</li>
</ul>
</li>
<li>Many husbands enjoy <strong>that they do the cooking</strong>.<ul>
<li>→ Many husbands enjoy <strong>doing the cooking</strong>.</li>
</ul>
</li>
<li>He got used to(介词) <strong>working late into the night</strong>.</li>
<li>His favorite pastime is <strong>that he goes fishing on weekend</strong>.<ul>
<li>→ His favorite pastime is <strong>going fishing on weekend</strong>.</li>
</ul>
</li>
<li>主语不能够省略<ul>
<li><span style="color:yellow">S+V+O+C</span><ul>
<li>I imagined that a beautiful girl was singing to me.<ul>
<li>→ <del>I imagined singing to myself.</del></li>
<li>→ I imagined a beautiful girl singing to me.</li>
</ul>
</li>
</ul>
</li>
<li><span style="color:yellow">用所有格</span><ul>
<li>That he calls my girlfriend every day is too much for me.<ul>
<li>→ <del>Calling my girlfriend every day is too much for me.</del></li>
<li>→ His calling my girlfriend every day is too much for me.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ol>
<h5 id="b-简化后剩下的补语式Ven形态时-无法取代名词"><a href="#b-简化后剩下的补语式Ven形态时-无法取代名词" class="headerlink" title="b. 简化后剩下的补语式Ven形态时, 无法取代名词"></a>b. 简化后剩下的补语式Ven形态时, <span style="color:red">无法取代名词</span></h5><ol>
<li><strong>That anyone is called a liar</strong> is the greatest insult.<ul>
<li>→ <del>Called a liar is the greatest insult.</del> (Wrong)</li>
<li>→ <strong>Being called a liar</strong> is the greatest insult.</li>
</ul>
</li>
<li>I am looking forward to(介词) <strong>being invited</strong> to the party</li>
</ol>
<h5 id="c-名词从句中是单纯的be动词"><a href="#c-名词从句中是单纯的be动词" class="headerlink" title="c. 名词从句中是单纯的be动词"></a>c. <span style="color:red">名词从句中是单纯的be动词</span></h5><ol>
<li><p><strong>That one is a teacher</strong> requires a lot of patience.</p>
<ul>
<li>→ <strong>Being a teacher</strong> requires a lot of patience.</li>
</ul>
</li>
<li><p><strong>That he was busy</strong> is no excuse for the negligence.</p>
<ul>
<li>→ <strong>Being busy</strong> is no excuse for the negligence.</li>
</ul>
</li>
</ol>
<h5 id="d-简化后剩下的补语是to-V形态"><a href="#d-简化后剩下的补语是to-V形态" class="headerlink" title="d. 简化后剩下的补语是to V形态"></a>d. 简化后剩下的补语是to V形态</h5><ol>
<li><p>The children expect <strong>that they can get presents for Christmas</strong>.</p>
<ul>
<li>→ The children expect <strong>to get presents for Christmas</strong>.</li>
</ul>
</li>
<li><p>I think it strange <strong>that man should fear ghosts.</strong></p>
<ul>
<li>→ I think it strange <strong>to fear ghosts</strong>.</li>
</ul>
</li>
<li><p>主语不合适省略</p>
<ul>
<li>I want <strong>that you should go</strong>.<ul>
<li>→ I want <strong>you to go</strong>.</li>
</ul>
</li>
</ul>
</li>
</ol>
<h5 id="e-疑问句的名词从句简化-疑问词要保留-where-to-how-to-when-to"><a href="#e-疑问句的名词从句简化-疑问词要保留-where-to-how-to-when-to" class="headerlink" title="e. 疑问句的名词从句简化, 疑问词要保留, where to/how to/when to"></a>e. 疑问句的名词从句简化, 疑问词要保留, where to/how to/when to</h5><ol>
<li><p>I don’t known <strong>what I should do</strong>.</p>
<ul>
<li>→ I don’t known <strong>what to do</strong>.</li>
</ul>
</li>
<li><p>I can’t decide <strong>whether I should vote for Mary(or not)</strong>.</p>
<ul>
<li>→ I can’t decide whether <strong>to vote for Mary</strong>.</li>
</ul>
</li>
</ol>
<h4 id="D-副词从句的简化"><a href="#D-副词从句的简化" class="headerlink" title="D. 副词从句的简化"></a>D. 副词从句的简化</h4><h5 id="a-简化为Ving补语"><a href="#a-简化为Ving补语" class="headerlink" title="a. 简化为Ving补语"></a>a. 简化为Ving补语</h5><ol>
<li>While he was lying on the couch, the boy fell asleep.<ul>
<li>→ <del>While</del> lying on the couch, the boy fell asleep.</li>
</ul>
</li>
</ol>
<h5 id="b-没有Be动词与助动词时"><a href="#b-没有Be动词与助动词时" class="headerlink" title="b. 没有Be动词与助动词时"></a>b. 没有Be动词与助动词时</h5><ol>
<li><strong>Because we have nothing to do here</strong>, we might as well go home.<ul>
<li>→ <strong>Having nothing to do here</strong>, we might as well go home.</li>
</ul>
</li>
<li><strong>Although we have nothing to do here</strong>, we can’t leave early.<ul>
<li>→ <strong>Although having nothing to do here</strong>, we can’t leave early. <span style="color:red">这种相反的逻辑关系要用although来表示, 所以although不能省略</span></li>
<li>→ <strong>Having nothing to do here</strong>, we <strong>still</strong> can’t leave early.</li>
</ul>
</li>
</ol>
<h5 id="c-副词从句中的动词单纯是Be"><a href="#c-副词从句中的动词单纯是Be" class="headerlink" title="c. 副词从句中的动词单纯是Be"></a>c. 副词从句中的动词单纯是Be</h5><ol>
<li><strong>As I am a student</strong>, I can’t afford to get married.<ul>
<li>→ <strong>Being a student</strong>, I can’t afford to get married.</li>
<li>→ <strong>As a student</strong>, I can’t afford to get married.</li>
</ul>
</li>
<li><strong>Before he was in school</strong>, he used to be a naughty child.<ul>
<li>→ <strong>Before being in school</strong>, he used to be a naughty child.</li>
</ul>
</li>
</ol>
<h5 id="d-时态的问题"><a href="#d-时态的问题" class="headerlink" title="d. 时态的问题"></a>d. 时态的问题</h5><ol>
<li><strong>After he wrote the letter</strong>, he put it to mail.<ul>
<li>→ <strong>After writing the letter</strong>, he put it to mail.</li>
<li>→ <del>Writing the letter, he put it to mail.</del>(Wrong)</li>
<li>→ <span style="color:red"> <strong>Having written the letter</strong>, he put it to mail.</span></li>
</ul>
</li>
<li><strong>When he had written the letter</strong>, he put it to mail.<ul>
<li>→ <span style="color:red"> <strong>Having written the letter</strong>, he put it to mail.</span></li>
</ul>
</li>
</ol>
<h2 id="VIII-Preposition"><a href="#VIII-Preposition" class="headerlink" title="VIII. Preposition"></a><a name="preposition">VIII. Preposition</a></h2><h4 id="A-Space"><a href="#A-Space" class="headerlink" title="A. Space"></a>A. Space</h4><h5 id="a-spot-→-at"><a href="#a-spot-→-at" class="headerlink" title="a. spot → at"></a>a. spot → at</h5><ol>
<li>Let’s meet <strong>at the railway station</strong>.</li>
</ol>
<h5 id="b-line-→-on-along"><a href="#b-line-→-on-along" class="headerlink" title="b. line → on, along"></a>b. line → on, along</h5><ol>
<li>Then we can go over the project <strong>on</strong> our way to Gaoxiong.</li>
<li>We may go walking through the windy park, or drive <strong>along</strong> the beach.</li>
</ol>
<h5 id="c-face-→-on"><a href="#c-face-→-on" class="headerlink" title="c. face → on"></a>c. face → on</h5><ol>
<li>Several boats can be seen on the lake.</li>
<li>on the internet/on Facebook/on Twitter</li>
</ol>
<h5 id="d-cube-→-in"><a href="#d-cube-→-in" class="headerlink" title="d. cube → in"></a>d. cube → in</h5><ol>
<li>It’s cool <strong>in the railway station</strong>, because they have air-condition.</li>
</ol>
<h4 id="B-Time"><a href="#B-Time" class="headerlink" title="B. Time"></a>B. Time</h4><h5 id="a-moment-→-at"><a href="#a-moment-→-at" class="headerlink" title="a. moment → at"></a>a. moment → at</h5><ol>
<li>The earthquake struck <strong>at</strong> 5:27AM</li>
</ol>
<h5 id="b-during-→-in"><a href="#b-during-→-in" class="headerlink" title="b. during → in"></a>b. during → in</h5><ol>
<li>Typhoon seldom come <strong>in</strong> Winter.</li>
</ol>
<h5 id="c-special-time-→-on"><a href="#c-special-time-→-on" class="headerlink" title="c. special time → on"></a>c. special time → on</h5><ol>
<li>There’ll be a concert <strong>on</strong> New Year’s Day.</li>
</ol>
<h2 id="IX-Article"><a href="#IX-Article" class="headerlink" title="IX. Article"></a><a name="article">IX. Article</a></h2>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.magicefire.com/Architecture-on-iOS/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Qubo Qin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Qubo Qin's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/Architecture-on-iOS/" itemprop="url">Architecture on iOS</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-28T13:29:45-07:00">
                2018-04-28
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Why-we-need-to-choice-an-architecture-before-we-write-a-program-on-iOS"><a href="#Why-we-need-to-choice-an-architecture-before-we-write-a-program-on-iOS" class="headerlink" title="Why we need to choice an architecture before we write a program on iOS"></a>Why we need to choice an architecture before we write a program on iOS</h3><h3 id="The-critirias-of-evaluration-of-architecture"><a href="#The-critirias-of-evaluration-of-architecture" class="headerlink" title="The critirias of evaluration of architecture"></a>The critirias of evaluration of architecture</h3><h3 id="The-History-of-architectures"><a href="#The-History-of-architectures" class="headerlink" title="The History of architectures"></a>The History of architectures</h3><h3 id="Design-Paradiam-and-Design-Principle"><a href="#Design-Paradiam-and-Design-Principle" class="headerlink" title="Design Paradiam and Design Principle"></a>Design Paradiam and Design Principle</h3><h5 id="SRP"><a href="#SRP" class="headerlink" title="SRP"></a>SRP</h5><p>Single Responsibility Principle<br>How to use SRP properly with clean Architecture. Every module or class should have responsibilty over a single part of the functionality provided by the software.</p>
<h4 id="MVC"><a href="#MVC" class="headerlink" title="MVC"></a>MVC</h4><h4 id="Apple’s-MVC"><a href="#Apple’s-MVC" class="headerlink" title="Apple’s MVC"></a>Apple’s MVC</h4><p>MVC introduced by Appll is stands for Massive View Controller. It is funny, but it is ture. But It is not the fault of the architecture, It depented on how we use it correctly. The architecture doesn’t tell us how to use it correctly and where to put all other responsibilty we need. </p>
<h4 id="MVVM"><a href="#MVVM" class="headerlink" title="MVVM"></a>MVVM</h4><h4 id="MVVM-with-RxSwift"><a href="#MVVM-with-RxSwift" class="headerlink" title="MVVM with RxSwift"></a>MVVM with RxSwift</h4><h4 id="MVVM-with-RxSwift-and-Coordinattor"><a href="#MVVM-with-RxSwift-and-Coordinattor" class="headerlink" title="MVVM with RxSwift and Coordinattor"></a>MVVM with RxSwift and Coordinattor</h4><h4 id="MVVM-with-ReSwift"><a href="#MVVM-with-ReSwift" class="headerlink" title="MVVM with ReSwift"></a>MVVM with ReSwift</h4><h4 id="Clean-Architecture"><a href="#Clean-Architecture" class="headerlink" title="Clean Architecture"></a>Clean Architecture</h4><p>Clean architecture explicitly divides some responsibilities among its classes: the presenters bridge the divide between UI and business logic, the interactors handle our use-cases, routers help us get to new scenes, etc. </p>
<p>Clean architecture has become quite popular on Apples platforms and for a good reason. There are even several approaches we can choose from, like VIPER [4] and Clean Swift [3].</p>
<p>The interactor contains the applications business logic but there’s only one interactor per view controller. </p>
<h5 id="Clean-Swift"><a href="#Clean-Swift" class="headerlink" title="Clean Swift"></a>Clean Swift</h5><p>In my opinion, in complex scenes, the interactor shouldn’t really do anything interesting. No algorithms, no database or parsing, nothing that requires a nested if statement or a loop. This belongs in Worker classes. The responsibility of the interactor will be delegating work to its workers and passing the results to the presenter. </p>
<p>In clean architecture, an interactor should represent a single use case. </p>
<h5 id="VIPER"><a href="#VIPER" class="headerlink" title="VIPER"></a>VIPER</h5><p>I heard many people say that VIPER is very complicated. </p>
<h4 id="Router"><a href="#Router" class="headerlink" title="Router"></a>Router</h4><h3 id="References"><a href="#References" class="headerlink" title="References"></a>References</h3><p><a href="https://medium.com/inloopx/cleaner-architecture-on-ios-ac4027b85d1f" target="_blank" rel="noopener">Cleaner Architecture on iOS</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.magicefire.com/my-first-blog/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Qubo Qin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Qubo Qin's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/my-first-blog/" itemprop="url">my first blog</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-03-07T16:08:43-08:00">
                2018-03-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/bio/" itemprop="url" rel="index">
                    <span itemprop="name">bio</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="This-is-my-blog"><a href="#This-is-my-blog" class="headerlink" title="This is my blog"></a>This is my blog</h2><h4 id="It’s-Me"><a href="#It’s-Me" class="headerlink" title="It’s Me"></a>It’s Me</h4><img src="/my-first-blog/QQB1.png">

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Qubo Qin</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">6</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">5</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">32</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Qubo Qin</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
